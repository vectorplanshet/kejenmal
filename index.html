<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—ñ—Ä–∞–∂ –ü–ü–û</title>
    <link rel="shortcut icon" href=".png" />
    <div class="template-container">
    </div>    <meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark">

<script src="https://d3js.org/d3.v7.min.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-measure/3.1.0/leaflet-measure.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch/dist/geosearch.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch/dist/geosearch.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <script
    src="https://cdn.jsdelivr.net/gh/gokertanrisever/leaflet-ruler@master/src/leaflet-ruler.js"
    integrity="sha384-8SqKZR7V8uOetpjjbcNJHvwuHpb074WS0UXjCLhzfJUqYn3B/uWx1WVv5mwRp1mV"
    crossorigin="anonymous"
></script>
    <style>
        /* General Map Styles */
        #map {
            height: 100vh;
        }
html {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}
html {
  color-scheme: light dark;              /* —Å–∞–π—Ç —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–º–∞–º–∏ */
  forced-color-adjust: none !important;  /* –ó–ê–ü–†–ï–¢ —Å–∏—Å—Ç–µ–º–Ω–æ–π –ø–µ—Ä–µ–∫—Ä–∞—Å–∫–∏ */
}

body {
  line-height: 1.2;
}
.label-container,
.r-container,
.rls-container,
.label1-container,
.r1-container {
  line-height: 1 !important;
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

body {
  position: fixed;
  transform-origin: center center;
  transition: transform 0.4s ease;
}

#topbar {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 60px;
    background-color: #2d3240; /* —Å–∏–Ω–∏–π */
    
    z-index: 1005;
}
#sidebar {
    position: absolute;
    top: 0;
    left: 0;
    width: 50px; /* –£–∑–∫–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
    height: 100%; /* –ù–∞ –≤—Å—é –≤—ã—Å–æ—Ç—É —ç–∫—Ä–∞–Ω–∞ */
    background-color: #2d3240; /* –¢–µ–º–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –ø–∞–Ω–µ–ª–∏ */
    z-index: 1000; /* –°–ª–æ–∏, —á—Ç–æ–±—ã –±—ã—Ç—å –≤—ã—à–µ –∫–∞—Ä—Ç—ã */
}
.leaflet-control-layers {
  z-index: 2000;
  position: relative;
  zoom: 0.8;
  transform-origin: top left;
  top: 25px;

  display: none; /* —Å–∫—Ä—ã—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ */
}

.leaflet-control-layers.active {
  display: block;
}

.modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.95);
    background: #252b36;
    padding: 16px 19px;
    border-radius: 11px;
    z-index: 1001;
    max-width: 288px;
    width: 90%;
    transition: all 0.35s ease;
    color: #f0f0f0;
    font-family: 'Segoe UI', sans-serif;
    font-size: 11.2px;
}

.modal h2 {
    font-size: 17.6px;
    color: #ffffff;
    margin-bottom: 12.8px;
    text-align: center;
}

input[type="text"] {
    width: 100%;
    padding: 6.4px 8px;
    font-size: 11.2px;
    background-color: #1e232c;
    color: #ffffff;
    border-radius: 6.4px;
    border: 1px solid #3a4152;
}

input[type="text"]:focus {
    border-color: #4a90e2;
    background-color: #252b36;
    outline: none;
}

.modal-button {
    width: 100%;
    padding: 9.6px;
    font-size: 12px;
    margin-top: 16px;
    background-color: #4674dc;
    color: white;
    border: none;
    border-radius: 6.4px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.modal-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(21, 24, 30, 0.85);
    z-index: 1000;
    display: none;
    backdrop-filter: blur(4px);
}

.modal.show {
    display: block;
    transform: translate(-50%, -50%) scale(1);
}

:root {
    --map-tiles-filter: brightness(0.6) invert(1) contrast(3) hue-rotate(200deg) saturate(0.5) brightness(0.7) grayscale(3);
}

    .map-tiles {
        filter: var(--map-tiles-filter, none);
    }

.modal-button:hover {
    background-color: #6088e7;
}

.modal-button:focus {
    outline: none;
}
/* –ö–∞—Å—Ç–æ–º–Ω–æ–µ –º–µ–Ω—é */    
        /* –°–¥–≤–∏–≥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–ø—Ä–∞–≤–æ –¥–ª—è –Ω—É–∂–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ */
        .shifted-info-container {
            margin-left: 2.1px; /* –°–¥–≤–∏–≥ –Ω–∞ 20px –≤–ø—Ä–∞–≤–æ, –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ */
        }
        .shifted-info-containerr {
            margin-right: 10px;
        }
    
 
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ü–≤–µ—Ç–∞ */

      .style-pomelo.shifted-id-x-101 {
    margin-left: 32px; /* 20 * 1.6 */
}
.style-pomelo .shifted-id {
    margin-left: 24px; /* 15 * 1.6 */
}
.style-pomelo .shifted-id-grumble,
.style-pomelo .shifted-id-kinzhal {
    margin-left: 40px; /* 25 * 1.6 */
}

.style-pomelo .info-container {
    line-height: 14px; /* 9 * 1.6 */
}
.style-pomelo .iconname {
    line-height: 8px; /* 5 * 1.6 */
}
.style-pomelo .info-container1 {
    line-height: 11px; /* 7 * 1.6 */
}
.style-pomelo .info-container {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 2px;

    padding: 2.5 20px 2.5 20px; /* ‚Üê –¥–æ–±–∞–≤—å px –ø–æ—Å–ª–µ 5 */
    min-width: 63px;
    height: 11px;
    line-height: 0.8;
transform: scale(0.95);

    border-style: solid;
    border-width: 1px;
    border-top-color: rgba(0,0,0,0.95);
    border-left-color: rgba(0,0,0,0.95);
    border-right-color: rgba(0,0,0,0.95);
    border-bottom-color: rgba(0,0,0,0.95);
    box-sizing: border-box;

    /* üëá –≤–æ—Ç —ç—Ç–∏ –¥–≤–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ */
    contain: layout paint;
    will-change: transform;
}
.style-pomelo .info-container.expanded {
    display: flex !important;
    flex-direction: column !important;
    align-items: center;
    justify-content: center;
    gap: 1px;
    padding: 3px 5px;
    height: auto !important;
    min-width: auto;
    line-height: 1;
}

.style-pomelo .label-container {
    font-size: 10.1px; /* 6.5 * 1.6 */
    font-weight: 800;
  font-family: "Nunito", sans-serif;
}

.style-pomelo .r-container {
    font-size: 10.1px;
    font-weight: 800;
  font-family: "Nunito", sans-serif;
}

.style-pomelo .rls1-container {
    font-size: 10.1px;
  font-family: "Nunito", sans-serif;
    display: flex;
    flex-direction: column;
    justify-content: center;
    font-weight: 600;
    color: #333333;
}

.style-pomelo .rls-container {
    font-size: 10.1px;
    display: flex;
  font-family: "Nunito", sans-serif;
    font-weight: 800;
    flex-direction: column;
    justify-content: center;
    color: #333333;
}

.style-pomelo .label1-container {
    font-size: 10.1px;
  font-family: "Nunito", sans-serif;
    font-weight: 600;
    color: #333333;
}

.style-pomelo .r1-container {
    font-size: 10.1px;
    font-weight: 600;
  font-family: "Nunito", sans-serif;
    color: #333333;
}

#deleteButton {
    width: 28px;            /* 18.5 * 1.6 */
    height: 26px;           /* 16 * 1.6 */
    border-radius: 1.6px;     /* 1 * 1.6 */
    background-color: var(--menu-bg);
    color: #888888;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    font-size: 12.8px;        /* 8 * 1.6 */
    border: none;
    cursor: pointer;
}

/* Smooth Transition for Modals */  
.modal.show {
    display: block;
    animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.style-pomelo .icon-container {
    display: flex;
    align-items: center;
    gap: 8px;              /* 10 * 1.6 */
    font-size: 11.2px;      /* 7 * 1.6 */
    position: absolute;
    white-space: nowrap;
}

.style-pomelo .icon-container .icon {
    width: 27px;          /* 19 * 1.6 */
    height: 27px;
    object-fit: cover;
    display: block;
}
.menu-text {
    position: fixed;
    right: 9px;                /* 10 * 1.6 */
    bottom: 6px;                /* 4 * 1.6 */
    font-size: 13px;            /* 8 * 1.6 */
    color: rgba(0,0,0,0.3);
    line-height: 1;
    text-align: right;
    margin-bottom: 0;
    padding-top: 5px;           /* 3 * 1.6 */
    z-index: 9999;
}
.style-pomelo .icon-container1 {
    display: flex;
    align-items: center;
    gap: 10.4px;            /* 6.5 * 1.6 */
    font-size: 11.2px;      /* 7 * 1.6 */
    position: absolute;
    white-space: nowrap;
}

.style-pomelo .icon-container1 .icon {
    width: 30.4px;          /* 19 * 1.6 */
    height: 30.4px;
    object-fit: cover;
    display: block;
}

/* Modal Input Background for Target Coordinates */
#targetModal {
    padding: 16px;          /* 10 * 1.6 */
    border-radius: 8px;     /* 5 * 1.6 */
}

#alert-container {
    position: absolute;
    top: 16px;              /* 10 * 1.6 */
    left: 16px;             /* 10 * 1.6 */
    z-index: 1000;
}

#alert-menu {
    background: #d2d2d2;
    padding: 16px;
    display: none;
    border: none;
    width: 200px;

    max-height: 80vh;              /* üëà –≥–ª–∞–≤–Ω–æ–µ */
    overflow-y: auto;              /* üëà —Å–∫—Ä–æ–ª–ª */
    -webkit-overflow-scrolling: touch;

    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #000000;
    font-size: 11.2px;
    transition: all 0.3s ease;

    position: absolute;
    touch-action: pan-y;            /* üëà –ö–†–ò–¢–ò–ß–ù–û */
}

#alert-menu:hover {
    box-shadow: 0px 9.6px 32px rgba(0, 0, 0, 0.2); /* *1.6 */
}

.leaflet-control-attribution {
    display: none !important;
}

#alert-menu h3 {
    margin: 0 0 8px;        /* 5 * 1.6 */
    text-align: center;
    font-size: 12.8px;      /* 8 * 1.6 */
    color: #c4c4c4;
}

#alert-menu div {
    margin-bottom: 4px;     /* 2.5 * 1.6 */
}

#alert-menu input[type=checkbox] {
    margin-right: 4px;      /* 2.5 * 1.6 */
}

button#alert-button {
    width: 27.2px;          /* 17 * 1.6 */
    height: 27.2px;
    border-radius: 50%;
    background-color: #D90045; 
    color: rgb(0, 0, 0);
    font-weight: bold;
  font-size: 7.2px !important;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    border: none;
    cursor: pointer;
      -webkit-text-size-adjust: none;
  text-size-adjust: none;
}

    .overlay {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 9999;
    width: 100%;
    height: 100%;
    background: rgba(255, 0, 0, 0.2);  /* –Ø—Ä–∫–æ-–∫—Ä–∞—Å–Ω—ã–π –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω –¥–ª—è —Ç–µ—Å—Ç–∞ */
    background: url('kod.png') center/cover no-repeat;
    pointer-events: none; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∏–∫–∞–º –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Å–∫–≤–æ–∑—å */
    z-index: 2000; /* –ü–æ–≤–µ—Ä—Ö –∫–∞—Ä—Ç—ã */
    opacity: 0.2; /* –°–¥–µ–ª–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É –º–µ–Ω–µ–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π */
    transition: filter 0.3s ease; /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ —Ñ–∏–ª—å—Ç—Ä–∞ */
}
/* –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ –æ–∫–Ω–∞ */
.leaflet-popup-content {
    background-color: #f0f0f0;
    color: #333;
    padding: 16px;              /* 10 * 1.6 */
    border-radius: 16px;        /* 10 * 1.6 */
    font-family: 'Arial', sans-serif;
    font-size: 22px;            /* 14 * 1.6 */
}

/* –°—Ç–∏–ª—å –¥–ª—è —Å—Ç—Ä–µ–ª–æ—á–∫–∏ –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ –æ–∫–Ω–∞ */
.leaflet-popup-tip {
    background-color: #f0f0f0;
}

.leaflet-popup-content-wrapper {
    zoom: 0.75; /* 0.5 * 1.6 */
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ–∫–Ω–∞ */
.leaflet-popup-content h3 {
    margin-top: 0;
    font-size: 26px;            /* 16 * 1.6 */
    color: #555;
}

.leaflet-control.ruler {
    position: absolute;
    right: 16px;                /* 10 * 1.6 */
    left: auto;
    top: auto;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Arial", sans-serif;
}

body {
    background: #f0f0f0;
}

/* –≠–∫—Ä–∞–Ω –ª–æ–≥–∏–Ω–∞ */
#passwordContainer {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #252b36;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    color: white;
    text-align: center;
    z-index: 1010;
}

#passwordContainer img {
    width: 200px;               /* 125 * 1.6 */
    height: auto;
}

#loginInput, #passwordInput {
    padding: 16px 12px;         /* 10px 7.5px * 1.6 */
    font-size: 11px;            /* 7 * 1.6 */
    width: 320px;               /* 200 * 1.6 */
    height: 24px;               /* 15 * 1.6 */
    border: none;
    border-radius: 3px;         /* 2 * 1.6 */
    background-color: #3d4558;
    color: #fff;
    text-align: left;
    background-position: 12px center; /* 7.5 * 1.6 */
    background-repeat: no-repeat;
    background-size: 20px;      /* 12.5 * 1.6 */
}

#loginInput::placeholder,
#passwordInput::placeholder {
    color: #b0b3b8;
}

#submitButton {
    padding: 10px 32px;         /* 6px 20px * 1.6 */
    font-size: 11px;            /* 7 * 1.6 */
    background-color: #4674dc;
    color: white;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
    border-radius: 0;
}

#submitButton:hover {
    background-color: #5c90de;
}

#submitButton:active {
    background-color: #0033cc;
    transform: scale(0.98);
}

#menu-icon {
    position: absolute;
    top: 14px;                  /* 8.5 * 1.6 */
    left: 16px;                 /* 10 * 1.6 */
    width: 136px;               /* 85 * 1.6 */
    height: 20px;               /* 12.5 * 1.6 */
}

.inputWrapper {
    display: flex;
    flex-direction: column;
    gap: 8px;                   /* 5 * 1.6 */
    margin-bottom: 164px;       /* 102.5 * 1.6 */
}

.custom-menu {
    position: absolute;
    bottom: 22px;               /* 16 * 1.6 */
    right: 4px;                /* 10 * 1.6 */
    display: flex;
    flex-direction: column;
    gap: 10px;                  /* 10 * 1.6 */
    z-index: 1000;
}

.menu-row {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 5px;                   /* 3 * 1.6 */
    justify-content: flex-start;
}

/* –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é */
.custom-button {
    width: 28px;                /* 19 * 1.6 */
    height: 26px;               /* 15 * 1.6 */
    background-color: var(--menu-bg);
    border-radius: 2.2px;       /* 1.5 * 1.6 */
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: default;
}

.custom-button img {
    width: 20px;                /* 12.5 * 1.6 */
    height: 20px;
}

.custom-button.green {
    background-color: var(--menu-bg);
}

/* –õ–µ–≤–∞—è —Å—Ç—Ä–µ–ª–∫–∞ */
#left-arrow-button {
    width: 28px;                /* 19 * 1.6 */
    height: 26px;               /* 15 * 1.6 */
    background-color: var(--menu-bg);
    display: flex;
    align-items: center;
        border-radius: 2.2px;       /* 1.5 * 1.6 */
    justify-content: center;
    padding: 0;
    border: none;
    cursor: pointer;
}

#left-arrow-button img {
    width: 18px;                /* 11 * 1.6 */
    height: 18px;
}
:root {
  --safe-top: 25px;
  --safe-bottom: 50px;
}

#warning-message {
    position: fixed;
    top: 0;
    width: 100%;

    height: auto;              /* –†–∞—Å—Ç—ë—Ç –ø–æ —Ç–µ–∫—Å—Ç—É */
    padding: 2px;              /* –û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –±—ã–ª–æ */
    box-sizing: border-box;    /* –ß—Ç–æ–±—ã padding –Ω–µ —Ä–∞–∑–¥—É–≤–∞–ª –ª–∏—à–Ω–µ–µ */

    background-color: rgba(0, 0, 0, 0.7);
    color: #D90045;
    text-align: center;
    font-size: 11.1px;
    line-height: 1.1;          /* –ß—É—Ç—å –ø–ª–æ—Ç–Ω–µ–µ —Å—Ç—Ä–æ–∫–∏ */

    z-index: 9999;
}

.hidden {
    display: none;
}

/* –ü–æ–¥–ø–∏—Å—å */



.dynamic-zoom {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: row;
      gap: 15px;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      z-index: 1000;
    }

    .dynamic-zoom.show {
      opacity: 1;
      pointer-events: auto;
    }

.dynamic-zoom button {
  width: 35px;
  height: 35px;
  background: white;
  border: none;
  cursor: pointer;
  font-size: 35px; /* —É–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
  padding: 0;
    display: flex;
  align-items: center;
  justify-content: center;
  margin: 0;
  line-height: 30px;
  text-align: center;
  border-radius: 0;
  box-shadow: none;

  color: black;
  -webkit-appearance: none;
  -webkit-tap-highlight-color: transparent;
}
.style-pomelo .leaflet-watermark {
  position: absolute;
  inset: 0;
  z-index: 9999;
  pointer-events: none;

  opacity: 0.27;
  background-repeat: repeat;

  /* —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å SVG */
  background-size: 105px 96px;

  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='105' height='96'%3E%3Cg transform='rotate(-41 52.5 48)'%3E%3Ctext x='52.5' y='14' text-anchor='middle' font-family='Arial' font-size='14' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='16' y='48' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='89' y='48' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='52.5' y='80' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3C/g%3E%3C/svg%3E");
}



#rightMenu {
  position: fixed;
  top: 65px;     /* ‚Üë –≤—ã—à–µ –æ—Ç—Å—Ç—É–ø */
  bottom: 390px;  /* ‚Üì –Ω–∏–∂–µ –æ—Ç—Å—Ç—É–ø */

  width: 290px;              /* —à–∏—Ä–æ–∫–∞—è –ø–∞–Ω–µ–ª—å */
  
  right: -290px;             /* –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç–∞ */

  background: #555;
  z-index: 3000;

  border-radius: 14px;

  transition: right 0.25s ease;
    pointer-events: auto;
}

/* –û–¢–ö–†–´–¢–û ‚Äî –í–´–õ–ï–ó–õ–ê –í–õ–ï–í–û, –°–ü–†–ê–í–ê –©–ï–õ–¨ */
#rightMenu.open {
  right: 16px;               /* ‚Üê –ó–ê–ó–û–† –°–ü–†–ê–í–ê */
}

.settings-panel {
  padding: 16px;
  color: #fff;
  font-family: sans-serif;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
.settings-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 14px;
}

/* –°—Ç—Ä–æ–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */
.setting-row {
  display: flex;
  align-items: center;
  justify-content: space-between; /* üî• –¢–ï–ö–°–¢ –°–õ–ï–í–ê, –¢–£–ú–ë–õ–ï–† –°–ü–†–ê–í–ê */
}

/* –¢–µ–∫—Å—Ç */
.setting-text {
  font-size: 14px;
  color: #f0f0f0;
}

/* ===== –¢–£–ú–ë–õ–ï–† ===== */
.switch {
  position: relative;
  width: 46px;
  height: 26px;
  flex-shrink: 0;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  inset: 0;
  background-color: #6b6b6b;
  border-radius: 20px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.slider::before {
  content: "";
  position: absolute;
  width: 20px;
  height: 20px;
  left: 3px;
  top: 3px;
  background-color: #e5e5e5;
  border-radius: 50%;
  transition: transform 0.2s;
}

.switch input:checked + .slider {
  background-color: #8bc34a;
}

.switch input:checked + .slider::before {
  transform: translateX(20px);
}
/* —Å–µ–∫—Ü–∏—è "–°—Ç–∏–ª—å" */
.style-section {
  margin-top: 24px;
}

/* –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
.style-title {
  font-size: 15px;
  font-weight: 500;
  margin-bottom: 8px;
  color: #f2f2f2;
}

/* –æ–±—ë—Ä—Ç–∫–∞ —Å–µ–ª–µ–∫—Ç–∞ */
.style-select {
  position: relative;
}

/* —Å–∞–º select */
.style-select select {
  width: 100%;
  padding: 10px 36px 10px 12px;

  background-color: #5a5a5a;
  color: #fff;
  border: none;
  border-radius: 10px;

  font-size: 14px;
  appearance: none;        /* —É–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å—Ç—Ä–µ–ª–∫—É */
  -webkit-appearance: none;
  outline: none;
  cursor: pointer;
}

/* –∫–∞—Å—Ç–æ–º–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ */
.style-select::after {
  content: "‚ñæ";
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: #ccc;
  pointer-events: none;
  font-size: 14px;
}

/* hover / focus */
.style-select select:hover,
.style-select select:focus {
  background-color: #626262;
}
/* ================================
   STYLE: MARIUPOL
   ================================ */

/* –¶–≤–µ—Ç–∞ ID */

/* ================================
   INFO CONTAINER
   ================================ */

.style-mariupol .info-container {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 2px;

    padding: 2.5 20px 2.5 20px; /* ‚Üê –¥–æ–±–∞–≤—å px –ø–æ—Å–ª–µ 5 */
    min-width: 67px;
    height: 11px;
    line-height: 0.8;
transform: scale(0.95);

    border-style: solid;
    border-width: 1px;
    border-top-color: rgba(0,0,0,0.95);
    border-left-color: rgba(0,0,0,0.95);
    border-right-color: rgba(0,0,0,0.95);
    border-bottom-color: #dcdcdc;
    box-sizing: border-box;

    /* üëá –≤–æ—Ç —ç—Ç–∏ –¥–≤–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ */
    contain: layout paint;
    will-change: transform;
}

/* –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
.style-mariupol .info-container.expanded {
    display: flex !important;
    flex-direction: column !important;
    align-items: center;
    justify-content: center;
    gap: 1px;
    padding: 3px 5px;
    height: auto !important;
    min-width: auto;
    line-height: 1;
}
.style-mariupol .leaflet-watermark {
  position: absolute;
  inset: 0;
  z-index: 9999;
  pointer-events: none;

  opacity: 0.27;
  background-repeat: repeat;

  /* —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å SVG */
  background-size: 105px 96px;

  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='105' height='96'%3E%3Cg transform='rotate(-41 52.5 48)'%3E%3Ctext x='52.5' y='14' text-anchor='middle' font-family='Arial' font-size='14' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='16' y='48' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='89' y='48' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='52.5' y='80' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3C/g%3E%3C/svg%3E");
}


/* ================================
   TEXT BLOCKS
   ================================ */

.style-mariupol .label-container {
  font-size: 10.4px;
  font-weight: 800;
  font-family: 'Roboto', sans-serif;
}

.style-mariupol .r-container {
  font-size: 10.4px;
  font-weight: 800;
  font-family: 'Roboto', sans-serif;
}

.style-mariupol .rls1-container {
  font-size: 10.4px;
  font-family: 'Roboto', sans-serif;
  display: flex;
  flex-direction: column;
  justify-content: center;
  font-weight: 600;
  color: #333333;
}

.style-mariupol .rls-container {
  font-size: 10.4px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  font-family: 'Roboto', sans-serif;
  font-weight: 800;
  color: #333333;
}

.style-mariupol .label1-container {
  font-size: 10.4px;
  font-family: 'Roboto', sans-serif;
  font-weight: 600;
  color: #333333;
}

.style-mariupol .r1-container {
  font-size: 10.4px;
  font-weight: 600;
  font-family: 'Roboto', sans-serif;
  color: #333333;
}
/* BANDERA LINE ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è DOM */
.style-bandera .icon-container::before {
  content: "";
  position: absolute;

  width: 33px;
  height: 0.6px;
  background-color: #dd0347;

  top: 47%;
  left: 9.6px;

  pointer-events: none;
}

/* ================================
   ICONS
   ================================ */

.style-mariupol .icon-container {
  display: flex;
  align-items: center;
  gap: 8px;

  font-size: 11.2px;
  position: absolute;
  white-space: nowrap;
}

.style-mariupol .icon-container .icon {
  width: 24.1px;
  height: 24.1px;
  object-fit: cover;
  display: block;
}

.style-mariupol .icon-container1 {
  display: flex;
  align-items: center;
  gap: 10.4px;

  font-size: 11.2px;
  position: absolute;
  white-space: nowrap;
}

.style-mariupol .icon-container1 .icon {
  width: 30.4px;
  height: 30.4px;
  object-fit: cover;
  display: block;
}
/* =====================================================
   BANDERA STYLE
   –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∫–ª–∞—Å—Å–æ–º .style-bandera –Ω–∞ body / root
   ===================================================== */
.style-bandera .info-container {
  position: relative;
  transition: transform 0.15s linear;
  will-change: transform;
}

/* ---------- COLORS ---------- */


/* ---------- SHIFTED IDS ---------- */
.style-bandera .shifted-id-x-101 {
  margin-left: 38.4px;
}

.style-bandera .shifted-id {
  margin-left: 28.8px;
}

.style-bandera .shifted-id-grumble,
.style-bandera .shifted-id-kinzhal {
  margin-left: 48px;
}

/* ---------- INFO CONTAINER ---------- */
.style-bandera .info-container {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 2px;

  position: relative;
  line-height: 10.8px;
}

/* –§–æ–Ω-–ø–ª–∞—à–∫–∞ */
.style-bandera .info-container::before {
  content: "";
  position: absolute;
  left: -10.8px;
  right: -10.8px;
  top: 0;
  bottom: 0;
  background-color: #ff6c5677;
  z-index: -1;
}

/* Expanded */
.style-bandera .info-container.expanded {
  display: flex !important;
  flex-direction: column !important;
  align-items: center;
  justify-content: center;

  gap: 1px;
  padding: 3px 4.8px;
  height: auto !important;
  min-width: auto;
  line-height: 1;
}

/* –î–æ–ø. –≤–∞—Ä–∏–∞–Ω—Ç—ã */
.style-bandera .iconname {
  line-height: 9.6px;
}

.style-bandera .info-container1 {
  line-height: 13.2px;
}

/* ---------- TEXT ---------- */
.style-bandera .label-container,
.style-bandera .r-container,
.style-bandera .rls1-container,
.style-bandera .rls-container,
.style-bandera .label1-container,
.style-bandera .r1-container {
  font-size: 10.3px;
  font-weight: 600;
  font-family: "Roboto", sans-serif;
  -webkit-text-stroke-color: black;
}
.style-bandera .label-container,
.style-bandera .r-container,
.style-bandera .rls-container,
.style-bandera .label1-container,
.style-bandera .r1-container {
  position: relative;
  transition: transform 0.15s linear;
  will-change: transform;
}

.style-bandera .rls1-container,
.style-bandera .rls-container {
  display: flex;
  flex-direction: column;
  justify-content: center;
}

/* ---------- ICON CONTAINERS ---------- */
.style-bandera .icon-container {
  display: flex;
  align-items: center;
  gap: 24px;
  /* —É–±–∏—Ä–∞–µ–º –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã */
  contain: none !important;
  overflow: visible !important;

  /* —á—Ç–æ–±—ã ::before –º–æ–≥ –≤—ã—Ö–æ–¥–∏—Ç—å */
  box-sizing: content-box !important;

  /* —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ */
  height: auto !important;
  min-height: unset !important;
  max-height: none !important;
  font-size: 8.4px;
  position: absolute;
  white-space: nowrap;
}

.style-bandera .icon-container .icon {
  width: 28.8px;
  height: 28.8px;
  object-fit: cover;
  display: block;
}

.style-bandera .icon-container1 {
  display: flex;
  align-items: center;
  gap: 7.8px;

  font-size: 8.4px;
  position: absolute;
  white-space: nowrap;
}

.style-bandera .icon-container1 .icon {
  width: 28.8px;
  height: 28.8px;
  object-fit: cover;
  display: block;
}

/* ---------- LINE ---------- */
.style-bandera .line {
  position: absolute;
  width: 33px;
  height: 0.6px;
  background-color: #dd0347;
  top: 47%;
  left: 9.6px;
  transform: rotate(-180deg);
}
.line {
  position: absolute;
  width: 33px;
  height: 0.6px;
  background-color: #dd0347;
  top: 47%;
  left: 9.6px;
  transform: rotate(-180deg);
}
.style-bandera .leaflet-watermark {
  position: absolute;
  inset: 0;
  z-index: 9999;
  pointer-events: none;
  opacity: 0.27;
  background-repeat: repeat;

  /* –°–£–©–ï–°–¢–í–ï–ù–ù–û –ë–û–õ–¨–®–ï –ó–ê–ó–û–† */
  background-size: 140px 125px;

  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='125'%3E%3Cg transform='rotate(-41 70 62.5)'%3E%3Ctext x='70' y='22' text-anchor='middle' font-family='Arial' font-size='16' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='22' y='62.5' text-anchor='middle' font-family='Arial' font-size='16' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='118' y='62.5' text-anchor='middle' font-family='Arial' font-size='16' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='70' y='105' text-anchor='middle' font-family='Arial' font-size='16' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3C/g%3E%3C/svg%3E");}

/* ===============================
   VLADIMIR STYLE
   =============================== */

            .style-vladimir .shifted-id-x-101 {
                margin-left: 20px;
        }
           .style-vladimir  .shifted-id {
                margin-left: 15px;
            }
            .style-vladimir .shifted-id-grumble {
                margin-left: 25px;
            }
           .style-vladimir  .shifted-id-kinzhal {
                margin-left: 25px;
            }
            .style-vladimir .info-container {
                line-height: 7.5px;
            }
        .style-vladimir .label-container {
        font-size: 12.6px;        /* 8.5 √ó 1.6 */
        font-weight: 600;
        font-family: 'Roboto', sans-serif;
        -webkit-text-stroke-color: black;
    }

    .style-vladimir .r-container {
        font-size: 12.6px;        /* 8.5 √ó 1.6 */
        font-weight: 600;
        font-family: 'Roboto', sans-serif;
    }

   .style-vladimir  .rls1-container {
        font-size: 10.4px;        /* 6.5 √ó 1.6 */
        font-family: 'Roboto', sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: center;
        font-weight: 600;
        color: #333333;
    }

    .style-vladimir.rls-container {
        font-size: 10.4px;        /* 6.5 √ó 1.6 */
        display: flex;
        font-family: 'Roboto', sans-serif;
        font-weight: 600;
        flex-direction: column;
        justify-content: center;
        color: #333333;
    }

    .style-vladimir .label1-container {
        font-size: 10.4px;        /* 6.5 √ó 1.6 */
        font-family: 'Roboto', sans-serif;
        font-weight: 600;
        -webkit-text-stroke-color: black;
        color: #333333;
    }

    .style-vladimir .r1-container {
        font-size: 10.4px;        /* 6.5 √ó 1.6 */
        font-weight: 600;
        font-family: 'Roboto', sans-serif;
        color: #333333;
    }
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–∫–æ–Ω–∫–∞–º–∏ */
   .style-vladimir  .icon-container {
        display: flex;
        align-items: center;
        gap: 19.2px;              /* 12 √ó 1.6 */
        font-size: 11.2px;        /* 7 √ó 1.6 */
        position: absolute;
        white-space: nowrap;
    }


    .style-vladimir .icon-container1 {
        display: flex;
        align-items: center;
        gap: 10.4px;              /* 6.5 √ó 1.6 */
        font-size: 11.2px;        /* 7 √ó 1.6 */
        position: absolute;
        white-space: nowrap;
    }
    .style-vladimir .icon-container1 .icon {
        width: 29px;              /* 20 √ó 1.6 */
        height: 29px;
        object-fit: cover;
        display: block;
    }

    .style-vladimir .icon-container .icon {
        width: 29px;              /* 20 √ó 1.6 */
        height: 29px;
        object-fit: cover;
        display: block;
    }

    .style-vladimir .leaflet-watermark {
  position: absolute;
  inset: 0;
  z-index: 9999;
  pointer-events: none;
  opacity: 0.3;
  background-repeat: repeat;

  /* —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å SVG */
  background-size: 105px 96px;

  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='105' height='96'%3E%3Cg transform='rotate(-41 52.5 48)'%3E%3Ctext x='52.5' y='16' text-anchor='middle' font-family='Arial' font-size='14' fill='%23000' fill-opacity='0.75'%3Eabf3c2d%3C/text%3E%3Ctext x='16' y='48' text-anchor='middle' font-family='Arial' font-size='14' fill='%23000' fill-opacity='0.75'%3Eabf3c2d%3C/text%3E%3Ctext x='89' y='48' text-anchor='middle' font-family='Arial' font-size='14' fill='%23000' fill-opacity='0.75'%3Eabf3c2d%3C/text%3E%3Ctext x='52.5' y='80' text-anchor='middle' font-family='Arial' font-size='14' fill='%23000' fill-opacity='0.75'%3Eabf3c2d%3C/text%3E%3C/g%3E%3C/svg%3E");
}

       .style-val-slom .shifted-id-x-101 {
            margin-left: 20px;
       }
      .style-val-slom  .shifted-id {
            margin-left: 15px;
        }
       .style-val-slom .shifted-id-grumble {
            margin-left: 25px;
        }
       .style-val-slom .shifted-id-kinzhal {
            margin-left: 25px;
        }
      .style-val-slom  .info-container {
            line-height: 7.5px;
        }
     .style-val-slom  .label-container {
    font-size: 13.6px;        /* 8.5 √ó 1.6 */
    font-weight: 600;
    font-family: 'Roboto', sans-serif;
    -webkit-text-stroke-color: black;
}

.style-val-slom .r-container {
    font-size: 13.6px;        /* 8.5 √ó 1.6 */
    font-weight: 600;
    font-family: 'Roboto', sans-serif;
}

.style-val-slom .rls1-container {
    font-size: 10.4px;        /* 6.5 √ó 1.6 */
    font-family: 'Roboto', sans-serif;
    display: flex;
    flex-direction: column;
    justify-content: center;
    font-weight: 600;
    color: #333333;
}

.style-val-slom .rls-container {
    font-size: 10.4px;        /* 6.5 √ó 1.6 */
    display: flex;
    font-family: 'Roboto', sans-serif;
    font-weight: 600;
    flex-direction: column;
    justify-content: center;
    color: #333333;
}

.style-val-slom .label1-container {
    font-size: 10.4px;        /* 6.5 √ó 1.6 */
    font-family: 'Roboto', sans-serif;
    font-weight: 600;
    -webkit-text-stroke-color: black;
    color: #333333;
}

.style-val-slom .r1-container {
    font-size: 10.4px;        /* 6.5 √ó 1.6 */
    font-weight: 600;
    font-family: 'Roboto', sans-serif;
    color: #333333;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–∫–æ–Ω–∫–∞–º–∏ */
.style-val-slom .icon-container {
    display: flex;
    align-items: center;
    gap: 19.2px;              /* 12 √ó 1.6 */
    font-size: 11.2px;        /* 7 √ó 1.6 */
    position: absolute;
    white-space: nowrap;
}


.style-val-slom .icon-container1 {
    display: flex;
    align-items: center;
    gap: 10.4px;              /* 6.5 √ó 1.6 */
    font-size: 11.2px;        /* 7 √ó 1.6 */
    position: absolute;
    white-space: nowrap;
}
.style-val-slom .icon-container1::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    width: 32px;              /* 20 √ó 1.6 */
    height: 1px;              /* 0.6 √ó 1.6 */
    background-color: rgb(0, 218, 0);
    border-radius: 1.6px;
}
.style-val-slom .icon-container1 .icon {
    width: 32px;              /* 20 √ó 1.6 */
    height: 32px;
    object-fit: cover;
    display: block;
}

.style-val-slom .icon-container .icon {
    width: 32px;              /* 20 √ó 1.6 */
    height: 32px;
    object-fit: cover;
    display: block;
}
.style-val-slom .leaflet-watermark {
  position: absolute;
  inset: 0;
  z-index: 9999;
  pointer-events: none;
  opacity: 0.27;
  background-repeat: repeat;

  /* –°–£–©–ï–°–¢–í–ï–ù–ù–û –ë–û–õ–¨–®–ï –ó–ê–ó–û–† */
  background-size: 140px 125px;

  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='125'%3E%3Cg transform='rotate(-41 70 62.5)'%3E%3Ctext x='70' y='22' text-anchor='middle' font-family='Arial' font-size='16' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='22' y='62.5' text-anchor='middle' font-family='Arial' font-size='16' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='118' y='62.5' text-anchor='middle' font-family='Arial' font-size='16' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='70' y='105' text-anchor='middle' font-family='Arial' font-size='16' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3C/g%3E%3C/svg%3E");}

/* –æ–±—ã—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî —Ç–µ–∫—Å—Ç "—Å—Ö–ª–æ–ø–Ω—É—Ç" */
.hide-text .icon-container:not(.expanded) .info-container {
  transform: scaleY(0);
  height: 0;
  overflow: hidden;
  pointer-events: none;
}


/* –±–∞–∑–æ–≤–æ ‚Äî —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤–∏–º–∫–Ω–µ–Ω–∏–π */
.icon-container::after {
  content: none;
}

/* —É–≤—ñ–º–∫–Ω–µ–Ω–æ */
.show-quality .icon-container::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;

  width: 32px;
  height: 1px;

  background-color: rgb(0, 218, 0);
  border-radius: 1.6px;
}

    .style-labrador  .shifted-id-x-101 {
    margin-left: 32px; /* 20 * 1.6 */
}
.style-labrador .shifted-id {
    margin-left: 24px; /* 15 * 1.6 */
}
.style-labrador .shifted-id-grumble,
.style-labrador .shifted-id-kinzhal {
    margin-left: 40px; /* 25 * 1.6 */
}

.style-labrador .info-container {
    line-height: 14px; /* 9 * 1.6 */
}
.style-labrador .iconname {
    line-height: 8px; /* 5 * 1.6 */
}
.style-labrador .info-container1 {
    line-height: 11px; /* 7 * 1.6 */
}
.style-labrador .info-container {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 2px;

    padding: 2.5 20px 2.5 20px; /* ‚Üê –¥–æ–±–∞–≤—å px –ø–æ—Å–ª–µ 5 */
    min-width: 63px;
    height: 11px;
    line-height: 0.8;
transform: scale(0.95);

    border-style: solid;
    border-width: 1px;
    border-top-color: rgba(0,0,0,0.95);
    border-left-color: rgba(0,0,0,0.95);
    border-right-color: rgba(0,0,0,0.95);
    border-bottom-color: #dcdcdc;
    box-sizing: border-box;

    /* üëá –≤–æ—Ç —ç—Ç–∏ –¥–≤–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ */
    contain: layout paint;
    will-change: transform;
}
.style-labrador .info-container.expanded {
    display: flex !important;
    flex-direction: column !important;
    align-items: center;
    justify-content: center;
    gap: 1px;
    padding: 3px 5px;
    height: auto !important;
    min-width: auto;
    line-height: 1;
}

/* ‚Äî‚Äî‚Äî –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã ‚Äî‚Äî‚Äî */
.style-labrador .label-container,
.style-labrador .r-container,
.style-labrador .rls1-container,
.style-labrador .rls-container,
.style-labrador .label1-container,
.style-labrador .r1-container {
    font-size: 10.3px;          /* 8.6√ó1.2 */
    font-weight: 400;
    font-family: 'Roboto', sans-serif;
    -webkit-text-stroke-color: black;
}

.style-labrador .rls1-container,
.style-labrador .rls-container {
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.style-labrador .icon-container {
    display: flex;
    align-items: center;
    gap: 12px;            /* 10 √ó 1.2 */
    font-size: 8.4px;     /* 7 √ó 1.2 */
    position: absolute;
    white-space: nowrap;
}

.style-labrador .icon-container .icon {
    width: 26px;        /* 24 √ó 1.2 */
    height: 26px;       /* 24 √ó 1.2 */
    object-fit: cover;
    display: block;
}

.style-labrador .icon-container1 {
    display: flex;
    align-items: center;
    gap: 7.8px;           /* 6.5 √ó 1.2 */
    font-size: 8.4px;     /* 7 √ó 1.2 */
    position: absolute;
    white-space: nowrap;  /* –£–±–∏—Ä–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Ç–µ–∫—Å—Ç–∞ */
}

.style-labrador .icon-container1 .icon {
    width: 24px;   /* 34 / 2 */
    height: 24px;  /* 34 / 2 */
    object-fit: cover;
    display: block;
}
.style-labrador .leaflet-watermark {
  position: absolute;
  inset: 0;
  z-index: 9999;
  pointer-events: none;

  opacity: 0.27;
  background-repeat: repeat;

  /* —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å SVG */
  background-size: 105px 96px;

  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='105' height='96'%3E%3Cg transform='rotate(-41 52.5 48)'%3E%3Ctext x='52.5' y='14' text-anchor='middle' font-family='Arial' font-size='14' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='16' y='48' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='89' y='48' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='52.5' y='80' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3C/g%3E%3C/svg%3E");
}


     .style-labrador-vl .shifted-id-x-101 {
    margin-left: 32px; /* 20 * 1.6 */
}
.style-labrador-vl .shifted-id {
    margin-left: 24px; /* 15 * 1.6 */
}
.style-labrador-vl .shifted-id-grumble,
.style-labrador-vl .shifted-id-kinzhal {
    margin-left: 40px; /* 25 * 1.6 */
}

.style-labrador-vl .info-container {
    line-height: 14px; /* 9 * 1.6 */
}
.style-labrador-vl .iconname {
    line-height: 8px; /* 5 * 1.6 */
}
.style-labrador-vl .info-container1 {
    line-height: 11px; /* 7 * 1.6 */
}
.style-labrador-vl .info-container {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 2px;

    padding: 2.5 20px 2.5 20px; /* ‚Üê –¥–æ–±–∞–≤—å px –ø–æ—Å–ª–µ 5 */
    min-width: 63px;
    height: 11px;
    line-height: 0.8;
transform: scale(0.95);

    border-style: solid;
    border-width: 1px;
    border-top-color: rgba(0,0,0,0.95);
    border-left-color: rgba(0,0,0,0.95);
    border-right-color: rgba(0,0,0,0.95);
    border-bottom-color: #dcdcdc;
    box-sizing: border-box;

    /* üëá –≤–æ—Ç —ç—Ç–∏ –¥–≤–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ */
    contain: layout paint;
    will-change: transform;
}
.style-labrador-vl .info-container.expanded {
    display: flex !important;
    flex-direction: column !important;
    align-items: center;
    justify-content: center;
    gap: 1px;
    padding: 3px 5px;
    height: auto !important;
    min-width: auto;
    line-height: 1;
}

/* ‚Äî‚Äî‚Äî –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã ‚Äî‚Äî‚Äî */
.style-labrador-vl .label-container,
.style-labrador-vl .r-container,
.style-labrador-vl .rls1-container,
.style-labrador-vl .rls-container,
.style-labrador-vl .label1-container,
.style-labrador-vl .r1-container {
    font-size: 10.3px;        /* 8.6 √ó 1.2 */
    font-weight: 800;
    font-family: 'Roboto', sans-serif;
    color: #333333;
    -webkit-text-stroke-color: black;
}

.style-labrador-vl .rls1-container,
.style-labrador-vl .rls-container {
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.style-labrador-vl .icon-container {
    display: flex;
    align-items: center;
    gap: 12px;          /* 10 √ó 1.2 */
    font-size: 8.4px;   /* 7 √ó 1.2 */
    position: absolute;
    white-space: nowrap;
}

.style-labrador-vl .icon-container .icon {
    width: 30px;      /* 26 √ó 1.2 */
    height: 30px;     /* 26 √ó 1.2 */
    object-fit: cover;
    display: block;
}
.style-labrador-vl .icon-container1 {
    display: flex;
    align-items: center;
    gap: 6.5px;   /* 13 / 2 */
    font-size: 7px; /* 14 / 2 */
    position: absolute;
    white-space: nowrap; /* –£–±–∏—Ä–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Ç–µ–∫—Å—Ç–∞ */
}
.style-labrador-vl .icon-container1 .icon {
    width: 31.2px;      /* 26 √ó 1.2 */
    height: 31.2px;     /* 26 √ó 1.2 */
    object-fit: cover;
    display: block;
}
/* üçà Pomelo */
.style-pomelo.show-quality .icon-container::after {
  width: 27px;
}

/* üü• Vladimir */
.style-vladimir.show-quality .icon-container::after {
  width: 29px;
}

/* üü¶ Bandera */
.style-bandera.show-quality .icon-container::after {
  width: 28.8px;
}

/* üü® Mariupol (–µ—Å–ª–∏ –µ—Å—Ç—å) */
.style-mariupol.show-quality .icon-container::after {
  width: 24.1px;
}

/* üü™ Val-slom */
.style-val-slom.show-quality .icon-container::after {
  width: 32px;
}
.style-labrador .icon-container::after {
    width: 26px;
}
.style-labrador-vl .icon-container::after {
    width: 30px;
}
.style-labrador-vl .leaflet-watermark {
  position: absolute;
  inset: 0;
  z-index: 9999;
  pointer-events: none;

  opacity: 0.27;
  background-repeat: repeat;

  /* —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å SVG */
  background-size: 105px 96px;

  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='105' height='96'%3E%3Cg transform='rotate(-41 52.5 48)'%3E%3Ctext x='52.5' y='14' text-anchor='middle' font-family='Arial' font-size='14' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='16' y='48' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='89' y='48' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='52.5' y='80' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3C/g%3E%3C/svg%3E");
}

.leaflet-scale-bracket {
  position: relative;
  width: 160px;
  height: 34px;
  pointer-events: none;
  font-size: 13px;
  font-weight: 500;
  color: #000;
}

/* –≤–µ—Ä—Ö–Ω—è—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å */
.leaflet-scale-bracket::before {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  height: 2px;          /* –±—ã–ª–æ 2px */
  background: #000;
  z-index: 9999;
}

/* –ª–µ–≤–∞—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å */
.leaflet-scale-bracket::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 2px;           /* –±—ã–ª–æ 2px */
  height: 8px;          /* –±—ã–ª–æ 14px */
  background: #000;
  z-index: 9999;
}

/* –ø—Ä–∞–≤–∞—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å */
.leaflet-scale-bracket .right {
  position: absolute;
  top: 0;
  right: 0;
  width: 2px;           /* –±—ã–ª–æ 2px */
  height: 8px;          /* –±—ã–ª–æ 14px */
  background: #000;
  z-index: 9999;
}

/* —Ç–µ–∫—Å—Ç –ø–æ–¥ —Å–∫–æ–±–∫–æ–π */
.leaflet-scale-bracket span {
  position: absolute;
  bottom: 15px;          /* –±—ã–ª–æ 14px */
  width: 100%;
  text-align: center;
  line-height: 2;
  font-size: 10px;      /* —É–º–µ–Ω—å—à–∏–ª–∏ —Ç–µ–∫—Å—Ç */
  z-index: 9999;
}

/* –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ (–ø–æ—Ä—Ç—Ä–µ—Ç), –ø–æ —Ü–µ–Ω—Ç—Ä—É */
.leaflet-control.leaflet-scale-bracket {
  position: fixed;
  top: -7px;
  left: 50%;
  transform: translateX(-50%);
}

/* –ø–ª–∞–Ω—à–µ—Ç / —ç–∫—Ä–∞–Ω –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ */
@media (orientation: landscape) {
  .leaflet-control.leaflet-scale-bracket {
    left: 300px;      /* —Å–º–µ—â–µ–Ω–∏–µ –≤–ª–µ–≤–æ */
    transform: none;  /* —É–±–∏—Ä–∞–µ–º —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ */
  }
}




      .style-pol.shifted-id-x-101 {
    margin-left: 32px; /* 20 * 1.6 */
}
.style-pol .shifted-id {
    margin-left: 24px; /* 15 * 1.6 */
}
.style-pol .shifted-id-grumble,
.style-pol .shifted-id-kinzhal {
    margin-left: 40px; /* 25 * 1.6 */
}

.style-pol .info-container {
    line-height: 14px; /* 9 * 1.6 */
}
.style-pol .iconname {
    line-height: 8px; /* 5 * 1.6 */
}
.style-pol .info-container1 {
    line-height: 11px; /* 7 * 1.6 */
}

.style-pol .label-container {
    font-size: 10.4px; /* 6.5 * 1.6 */
    font-weight: 800;
    font-family: 'Roboto', sans-serif;
}

.style-pol .r-container {
    font-size: 10.4px;
    font-weight: 800;
    font-family: 'Roboto', sans-serif;
}

.style-pol .rls1-container {
    font-size: 10.4px;
    font-family: 'Roboto', sans-serif;
    display: flex;
    flex-direction: column;
    justify-content: center;
    font-weight: 600;
    color: #333333;
}

.style-pol .rls-container {
    font-size: 10.4px;
    display: flex;
    font-family: 'Roboto', sans-serif;
    font-weight: 800;
    flex-direction: column;
    justify-content: center;
    color: #333333;
}

.style-pol .label1-container {
    font-size: 10.4px;
    font-family: 'Roboto', sans-serif;
    font-weight: 600;
    color: #333333;
}

.style-pol .r1-container {
    font-size: 10.4px;
    font-weight: 600;
    font-family: 'Roboto', sans-serif;
    color: #333333;
}

.style-pol .icon-container {
    display: flex;
    align-items: center;
    gap: 14px;              /* 10 * 1.6 */
    font-size: 11.2px;      /* 7 * 1.6 */
    position: absolute;
    white-space: nowrap;
}

.style-pol .icon-container .icon {
    width: 30px;          /* 19 * 1.6 */
    height: 30px;
    object-fit: cover;
    display: block;
}
.menu-text {
    position: fixed;
    right: 9px;                /* 10 * 1.6 */
    bottom: 6px;                /* 4 * 1.6 */
    font-size: 13px;            /* 8 * 1.6 */
    color: rgba(0,0,0,0.3);
    line-height: 1;
    text-align: right;
    margin-bottom: 0;
    padding-top: 5px;           /* 3 * 1.6 */
    z-index: 9999;
}
.style-pol .icon-container1 {
    display: flex;
    align-items: center;
    gap: 10.4px;            /* 6.5 * 1.6 */
    font-size: 11.2px;      /* 7 * 1.6 */
    position: absolute;
    white-space: nowrap;
}

.style-pol .icon-container1 .icon {
    width: 30.4px;          /* 19 * 1.6 */
    height: 30.4px;
    object-fit: cover;
    display: block;
}

.style-pol .leaflet-watermark {
  position: absolute;
  inset: 0;
  z-index: 9999;
  pointer-events: none;

  opacity: 0.27;
  background-repeat: repeat;

  /* —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å SVG */
  background-size: 105px 96px;

  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='105' height='96'%3E%3Cg transform='rotate(-41 52.5 48)'%3E%3Ctext x='52.5' y='14' text-anchor='middle' font-family='Arial' font-size='14' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='16' y='48' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='89' y='48' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='52.5' y='80' text-anchor='middle' font-family='Arial' font-size='15' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3C/g%3E%3C/svg%3E");
}


.style-val .shifted-id-x-101 {
            margin-left: 20px;
       }
.style-val  .shifted-id {
            margin-left: 15px;
        }
.style-val .shifted-id-grumble {
            margin-left: 25px;
        }
.style-val .shifted-id-kinzhal {
            margin-left: 25px;
        }
.style-val  .info-container {
            line-height: 7.5px;
        }
.style-val  .label-container {
    font-size: 13.6px;        /* 8.5 √ó 1.6 */
    font-weight: 600;
    font-family: 'Roboto', sans-serif;
    -webkit-text-stroke-color: black;
}

.style-val .r-container {
    font-size: 13.6px;        /* 8.5 √ó 1.6 */
    font-weight: 600;
    font-family: 'Roboto', sans-serif;
}

.style-val .rls1-container {
    font-size: 10.4px;        /* 6.5 √ó 1.6 */
    font-family: 'Roboto', sans-serif;
    display: flex;
    flex-direction: column;
    justify-content: center;
    font-weight: 600;
    color: #333333;
}

.style-val .rls-container {
    font-size: 10.4px;        /* 6.5 √ó 1.6 */
    display: flex;
    font-family: 'Roboto', sans-serif;
    font-weight: 600;
    flex-direction: column;
    justify-content: center;
    color: #333333;
}

.style-val .label1-container {
    font-size: 10.4px;        /* 6.5 √ó 1.6 */
    font-family: 'Roboto', sans-serif;
    font-weight: 600;
    -webkit-text-stroke-color: black;
    color: #333333;
}

.style-val .r1-container {
    font-size: 10.4px;        /* 6.5 √ó 1.6 */
    font-weight: 600;
    font-family: 'Roboto', sans-serif;
    color: #333333;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–∫–æ–Ω–∫–∞–º–∏ */
.style-val .icon-container {
    display: flex;
    align-items: center;
    gap: 19.2px;              /* 12 √ó 1.6 */
    font-size: 11.2px;        /* 7 √ó 1.6 */
    position: absolute;
    white-space: nowrap;
}


.style-val .icon-container1 {
    display: flex;
    align-items: center;
    gap: 10.4px;              /* 6.5 √ó 1.6 */
    font-size: 11.2px;        /* 7 √ó 1.6 */
    position: absolute;
    white-space: nowrap;
}
.style-val .icon-container1::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    width: 32px;              /* 20 √ó 1.6 */
    height: 1px;              /* 0.6 √ó 1.6 */
    background-color: rgb(0, 218, 0);
    border-radius: 1.6px;
}
.style-val .icon-container1 .icon {
    width: 32px;              /* 20 √ó 1.6 */
    height: 32px;
    object-fit: cover;
    display: block;
}

.style-val .icon-container .icon {
    width: 32px;              /* 20 √ó 1.6 */
    height: 32px;
      contain: layout paint; /* ‚Üê –í–ê–ñ–ù–û */
  transform: translateZ(0); /* —Ñ–æ—Ä—Å GPU */
    object-fit: cover;
    display: block;
}
    .style-val .leaflet-watermark {
  position: absolute;
  inset: 0;
  z-index: 9999;
  pointer-events: none;
  opacity: 0.27;
  background-repeat: repeat;

  /* –°–£–©–ï–°–¢–í–ï–ù–ù–û –ë–û–õ–¨–®–ï –ó–ê–ó–û–† */
  background-size: 140px 125px;

  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='125'%3E%3Cg transform='rotate(-41 70 62.5)'%3E%3Ctext x='70' y='22' text-anchor='middle' font-family='Arial' font-size='16' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='22' y='62.5' text-anchor='middle' font-family='Arial' font-size='16' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='118' y='62.5' text-anchor='middle' font-family='Arial' font-size='16' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3Ctext x='70' y='105' text-anchor='middle' font-family='Arial' font-size='16' fill='%23000' fill-opacity='0.75'%3Eabf2a1d%3C/text%3E%3C/g%3E%3C/svg%3E");}

/* üîí –§–∏–∫—Å–∞—Ü–∏—è –∏–∫–æ–Ω–∫–∏ –¢–û–õ–¨–ö–û –¥–ª—è style-val */
.style-val .icon-container .icon {
    content: url("neyst tip.png") !important;
    pointer-events: none;
}

/* ================================
   STYLE-VAL: —Ñ–∏–∫—Å–∞—Ü–∏—è –∏–∫–æ–Ω–æ–∫
   ================================ */

/* ======================================
   STYLE-VAL ‚Äî –∂—ë—Å—Ç–∫–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è –∏–∫–æ–Ω–æ–∫
   –ø–æ iconClass
   ====================================== */

/* blue-id */
.style-val .blue-id .icon,
.style-val .icon.blue-id {
    content: url("blue 2.png") !important;
}

/* red-id */
.style-val .red-id .icon,
.style-val .icon.red-id {
    content: url("neyst tip.png") !important;
}

/* zl */
.style-val .zl .icon,
.style-val .icon.zl {
    content: url("zl.png") !important;
}

/* vertolet */
.style-val .vertolet .icon,
.style-val .icon.vertolet {
    content: url("blue 2.png") !important;
}

/* litak */
.style-val .litak .icon,
.style-val .icon.litak {
    content: url("zl.png") !important;
}

/* perexop */
.style-val .perexop .icon,
.style-val .icon.perexop {
    content: url("zl.png") !important;
}

/* kr */
.style-val .kr .icon,
.style-val .icon.kr {
    content: url("neyst tip.png") !important;
}
.style-val .eppo .icon,
.style-val .icon.eppo {
    content: url("EPVO.png") !important;
}
.label-container::after {
    content: "—Ä";
    margin-left: -0.25em;
}
.style-val .label-container::after {
    content: "";
    margin-left: 0;
}
.icon-container.expanded .label-container::after {
    content: "—Ä" !important;
    margin-left: 0 !important;
}
/* –ì–õ–û–ë–ê–õ–¨–ù–´–ô –°–ë–†–û–° –ü–ï–†–ï–î –ü–†–ò–ú–ï–ù–ï–ù–ò–ï–ú –°–¢–ò–õ–Ø */
.icon-container {
  contain: none;
  transform: none;
  will-change: auto;
}
:root {
  --menu-bg: #5B595C; /* —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
}

/* —Å–≤–µ—Ç–ª–∞—è —Å–∏—Å—Ç–µ–º–Ω–∞—è —Ç–µ–º–∞ */
@media (prefers-color-scheme: light) {
  :root {
    --menu-bg: #D6D8D7;
  }
}
.zl,
.perexop,
.litak {
  color: #000 !important;
}
.icon-container * {
  color: #000;
}

.trash-icon {
  color: #9E9EA2 !important;
}
.label-container,
.r-container,
.rls-container,
.label1-container,
.r1-container {
  line-height: 1 !important;
}
.scalable-marker {
    transform-origin: center center;
    will-change: transform;
}
.no-auto-dark {
  color-scheme: light;
  forced-color-adjust: none;
}
.city-marker {
  position: relative;
  width: 120px;
  height: 24px;
}

/* –ö—Ä–µ—Å—Ç–∏–∫ */
.city-marker .cross {
  position: absolute;
  left: 12px;   /* = iconAnchor X */
  top: 12px;    /* = iconAnchor Y */
  width: 14px;
  height: 14px;
  transform: translate(-50%, -50%);
}

.city-marker .cross::before,
.city-marker .cross::after {
  content: "";
  position: absolute;
  left: 0;
  top: 6px;
  width: 14px;
  height: 1px;
  background: red;
  transform-origin: center;
}
.city-marker .cross::before { transform: rotate(45deg); }
.city-marker .cross::after  { transform: rotate(-45deg); }

/* –¢–µ–∫—Å—Ç */
.city-marker .label {
  position: absolute;
  left: 24px;  /* –ø—Ä–∞–≤–µ–µ –∫—Ä–µ—Å—Ç–∏–∫–∞ */
  top: 4px;    /* –Ω–µ–º–Ω–æ–≥–æ –≤—ã—à–µ —Ü–µ–Ω—Ç—Ä–∞ */
  font-size: 7px;
  color: red;
  white-space: nowrap;
}
:root {
  --menu-bg: #5B595C;
  --menu-line: #D6D8D7;
}

@media (prefers-color-scheme: light) {
  :root {
    --menu-bg: #D6D8D7;
    --menu-line: #5B595C;
  }
}

#fullscreenBtn {
    position: relative;
}

#fullscreenBtn::after {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;

    height: 3px;
    background-color: var(--menu-line);
}
#left-arrow-button {
  display: none;
}


#zoom-out {
  line-height: 38px;   /* ‚¨ÖÔ∏è –æ–ø—É—Å–∫–∞–µ–º –º–∏–Ω—É—Å */
}
.dynamic-zoom button:disabled {
  background: #CCCCCC;   /* —Å–µ—Ä–∞—è –∫–Ω–æ–ø–∫–∞ */
  cursor: default;
  pointer-events: none;
}
.icon-container {
  transform-origin: center center;
  will-change: transform;
}
/* –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –ß–Å–†–ù–´–ô */
.red-id,
.red-id *,
.blue-id,
.blue-id * {
  color: #000000;
}

/* –≤–∫–ª—é—á—ë–Ω —Ñ–æ—Ä–º—É–ª—è—Ä –∫–æ–ª—å–æ—Ä–æ–º —Ü—ñ–ª—ñ */
body.formular-color .red-id,
body.formular-color .red-id * {
  color: #D90047;
}

body.formular-color .blue-id,
body.formular-color .blue-id * {
  color: #1976D3;
}
#plusPopup {
  position: fixed;
  right: 0px;

  bottom: 80px;   /* —è–∫–æ—Ä—å —É –∫–Ω–æ–ø–∫–∏ */
  top: 0px;        /* —Ä–∞—Å—Ç—ë—Ç –í–í–ï–†–• –¥–æ –º–∞–∫—Å–∏–º—É–º–∞ */

  width: 260px;
  background: #1e1e1e;
  border-radius: 0;

  z-index: 9999;

  overflow-y: auto;

  /* –∞–Ω–∏–º–∞—Ü–∏—è */
  opacity: 0;
  transform: translateY(10px);
  pointer-events: none;
  transition: opacity 0.18s ease, transform 0.18s ease;
}

/* –æ—Ç–∫—Ä—ã—Ç–æ */
#plusPopup.open {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

.plus-item {
  padding: 20px 18px;        /* ‚¨ÜÔ∏è –í–´–®–ï */
  font-size: 15px;
  font-weight: 500;
  color: #ffffff;
  cursor: pointer;
}

.plus-item:not(:last-child) {
  border-bottom: 1px solid #2f2f2f;
}

.plus-item:hover {
  background: #2b2b2b;
}

.plus-item.danger {
  color: #ff4d4d;
}

.azimuth-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  z-index: 4000;
  display: none;
    pointer-events: auto;
}

.azimuth-modal {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 340px;
  background: #2f2f2f;
  border-radius: 14px;
  padding: 16px;
  color: #e6e6e6;
  font-family: system-ui, sans-serif;
}

.azimuth-title {
  text-align: center;
  font-size: 15px;
  margin-bottom: 14px;
}

.azimuth-section {
  margin-bottom: 14px;
}

.azimuth-section-title {
  font-size: 12px;
  color: #bdbdbd;
  margin-bottom: 6px;
}

.azimuth-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
}

.azimuth-modal input {
  background: transparent;
  border: none;
  border-bottom: 1px solid #6b6b6b;
  color: #fff;
  font-size: 12px;
  padding: 4px 2px;
}

.azimuth-modal input:focus {
  outline: none;
  border-bottom-color: #9ad27a;
}

.azimuth-wide {
  width: 100%;
  margin-bottom: 6px;
}

.azimuth-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 10px;
}

.azimuth-link {
  font-size: 12px;
  color: #7fcf6a;
  cursor: pointer;
}

.azimuth-apply {
  background: none;
  border: none;
  color: #7fcf6a;
  font-size: 13px;
  cursor: pointer;
}
.azimuth-range {
  width: 100%;
  margin-top: 6px;
}

.azimuth-range-scale {
  display: flex;
  justify-content: space-between;
  font-size: 11px;
  opacity: .6;
  margin-top: 2px;
}

.azimuth-row-title {
  font-size: 13px;
  margin-bottom: 6px;
}

.azimuth-toggle {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 16px;
  font-size: 13px;
}

/* Switch */
.azimuth-switch {
  position: relative;
  width: 42px;
  height: 22px;
}

.azimuth-switch input {
  display: none;
}

.azimuth-slider {
  position: absolute;
  inset: 0;
  background: #555;
  border-radius: 22px;
}

.azimuth-slider::before {
  content: "";
  position: absolute;
  width: 18px;
  height: 18px;
  left: 2px;
  top: 2px;
  background: #ccc;
  border-radius: 50%;
  transition: .2s;
}

.azimuth-switch input:checked + .azimuth-slider {
  background: #6aa84f;
}

.azimuth-switch input:checked + .azimuth-slider::before {
  transform: translateX(20px);
}
.azimuth-label {
  color: #2f47ff;
  font-size: 11px;
  font-weight: 500;
  white-space: nowrap;
}

.azimuth-angle {
  color: #2f47ff;
  font-size: 11px;
  font-weight: 600;
  transform: translate(-50%, -50%);
  white-space: nowrap;
}
.azimuth-overlay {
  pointer-events: auto;
}

.azimuth-modal {
  pointer-events: auto;
}
.azimuth-angle-label {
  color: #2f47ff;
  font-size: 11px;
  font-weight: 400;          /* –ù–ï –∂–∏—Ä–Ω—ã–π */
  font-family: Arial, sans-serif;

  white-space: nowrap;
  line-height: 1;

  pointer-events: none;
  background: transparent;

  /* ‚ùå –Ω–∏–∫–∞–∫–∏—Ö transform */
}
#azimuthOverlay .azimuth-modal {
  width: min(600px, 96vw);
  min-height: 520px;
}
#azimuthOverlay .azimuth-footer {
  margin-top: auto; /* ‚¨ÖÔ∏è —É–µ–∑–∂–∞–µ—Ç –≤–Ω–∏–∑ */
}


    </style>
</head>
<body>
    <div id="warning-message">
</div>
    </div>  
    <div id="leaflet-control-layers"></div>
    </div>
<div id="rightMenu">
  <div class="settings-panel">
    <div class="settings-title">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</div>

    <div class="setting-row">
      <span class="setting-text">–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –∫–æ—Ä–¥–æ–Ω</span>
      <label class="switch">
        <input type="checkbox" id="toggleFront" checked>
        <span class="slider"></span>
      </label>
    </div>

    <div class="setting-row">
      <span class="setting-text">–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ —Ç—Ä–∏–≤–æ–≥–∏</span>
      <label class="switch">
        <input type="checkbox" id="toggleAlerts" checked>
        <span class="slider"></span>
      </label>
    </div>
<div class="setting-row">
  <span class="setting-text">–ü–æ–∫–∞–∑–∞—Ç–∏ –ª—ñ–Ω—ñ—é –±–æ–π–æ–≤–æ–≥–æ –∑—ñ—Ç–∫–Ω–µ–Ω–Ω—è</span>
  <label class="switch">
    <input type="checkbox" id="toggleFrontLine">
    <span class="slider"></span>
  </label>
</div>
<div class="setting-row">
  <span class="setting-text">–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç</span>
  <label class="switch">
    <input type="checkbox" id="toggleText" checked>
    <span class="slider"></span>
  </label>
</div>
<div class="setting-row">
  <span class="setting-text">–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ —è–∫—ñ—Å—Ç—å —Ñ—ñ–∫—Å—É–≤–∞–Ω–Ω—è</span>
  <label class="switch">
    <input type="checkbox" id="toggleQuality">
    <span class="slider"></span>
  </label>
</div>

<div class="setting-row">
  <span class="setting-text">–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –ø–æ–∑–∏—Ü—ñ—é</span>
  <label class="switch">
    <input type="checkbox" id="togglePosition">
    <span class="slider"></span>
  </label>
</div>

<div class="setting-row">
  <span class="setting-text">–í—Å—ñ –≤–æ—Ä–æ–∂—ñ –ª–µ—Ç–æ–≤–∏—â–∞</span>
  <label class="switch">
    <input type="checkbox" id="toggleAirfields" checked>
    <span class="slider"></span>
  </label>
</div>
<div class="setting-row">
  <span class="setting-text">–§–æ—Ä–º—É–ª—è—Ä –∫–æ–ª—å–æ—Ä–æ–º —Ü—ñ–ª—ñ</span>
  <label class="switch">
    <input type="checkbox" id="forceTargetColors">
    <span class="slider"></span>
  </label>
</div>

    <!-- üîΩ –°–¢–ò–õ–¨ –í–ù–£–¢–†–ò –ü–ê–ù–ï–õ–ò -->
    <div class="style-section">
      <div class="style-title">–°—Ç–∏–ª—å</div>
      <div class="style-select">
        <select id="styleSelect">
          <option value="pomelo" selected>–ü–æ–º–µ–ª–æ</option>
          <option value="mariupol">–ú–∞—Ä–∏—É–ø–æ–ª—å</option>
          <option value="bandera">–ë–∞–Ω–¥–µ—Ä–∞</option>
          <option value="vladimir">–í–ª–∞–¥–∏–º–∏—Ä</option>
         <option value="val-slom">–í–∞–ª–∏</option>
          <option value="val">–í–∞–ª–∏ —Å–ª–æ–º–∞–Ω–Ω—ã–π</option>
          <option value="labrador">–õ–∞–±—Ä–∞–¥–æ—Ä –≤–ª–∞—Å–Ω–∏–π</option>
        <option value="labrador-vl">–õ–∞–±—Ä–∞–¥–æ—Ä –º–≤–≥</option>
        <option value="pol">–ü–æ–ª–∫–∞</option>

        </select>
      </div>
    </div>
<div class="style-section">
  <div class="style-title">–ö–∞—Ä—Ç–∞</div>
  <div class="style-select">
    <select id="mapSelect">
      <option value="osm" selected>OSM</option>
      <option value="osmGray">OSM Gray</option>
      <option value="satellite">Satellite</option>
      <option value="googleStreets">Google Maps</option>
      <option value="googleHybrid">Google Hybrid</option>
      <option value="googleTerrain">Google Terrain</option>
      <option value="openTopo">OpenTopoMap</option>
      <option value="googleTerrainGray">Google Terrain Gray</option>
    </select>
  </div>
</div>

  </div>
</div>
    <div id="map"></div>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç -->
  <!-- –ú–µ–Ω—é –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É -->
 <div class="custom-menu">
      <div class="menu-row">
    <div style="width: 130px;"></div>
    <button id="left-arrow-button">
      <img src="metka.png" alt="Arrow" />
    </button>
  </div>


  <!-- –ø–µ—Ä–≤—ã–µ –¥–≤–µ –∫–Ω–æ–ø–∫–∏ -->
  <div class="menu-row">
    <div style="width: 97px;"></div>
    <div class="custom-button" id="addPointBtn">
      <img src="reload.png" alt="Reload" />
    </div>
    <div class="custom-button">
      <img src="search.png" alt="Search" />
    </div>
  </div>
<div class="menu-row">
  <div style="width: 130px;"></div> <!-- 81 * 1.6 -->
  <div class="custom-button">
    <img src="signal.png" alt="Signal" />
  </div>
</div>
<div class="menu-row">
  <div style="width: 130px;"></div>
  <div class="custom-button" id="fullscreenBtn">
    <img src="ugol.png" alt="Arrow" />
  </div>
</div>
<div class="menu-row">
  <div style="width: 130px;"></div>
  <div class="custom-button">
    <img
      id="toggleLayersImg"
      src="pryamougol.png"
      alt="Layer"
      style="cursor: pointer;"
    />
  </div>
</div>
<div class="menu-row">
  <div style="width: 130px;"></div>
  <div class="custom-button green">
    <img src="plus.png" alt="Plus" id="plusBtn" />
  </div>
</div>
<div class="menu-row">
  <div style="width: 98px;"></div> <!-- 40 * 1.6 -->
  <button id="alert-button">0</button>
  <button id="deleteButton"><i class="fas fa-trash-alt"></i></button>
</div>

      <!-- –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ç–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ –º–µ–Ω—é -->

</div>

  </div>

<!-- popup –º–µ–Ω—é -->
<div id="plusPopup">
    <div class="plus-item" id="azimuthOpen">–ê–∑–∏–º—É—Ç–∞–ª—å–Ω–∞ —Å—ñ—Ç–∫–∞</div>
</div>
<div class="azimuth-overlay" id="azimuthOverlay">
  <div class="azimuth-modal">

    <div class="azimuth-title">
      –í–≤–µ–¥—ñ—Ç—å GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ê–∑–∏–º—É—Ç–∞–ª—å–Ω–∞ —Å—ñ—Ç–∫–∞
    </div>

    <!-- –°–ö-42 -->
    <div class="azimuth-section">
      <div class="azimuth-section-title">
        –°–ö-42 –ì—Ä–∞–¥—É—Å–∏ –•–≤–∏–ª–∏–Ω–∏ –°–µ–∫—É–Ω–¥–∏
      </div>

      <div class="azimuth-grid">
        <input placeholder="–® –°–ö42 ¬∞">
        <input placeholder="–® –°–ö42 '">
        <input placeholder='–® –°–ö42 "'>

        <input placeholder="–î –°–ö42 ¬∞">
        <input placeholder="–î –°–ö42 '">
        <input placeholder='–î –°–ö42 "'>
      </div>
    </div>

    <!-- WGS-84 DMS -->
    <div class="azimuth-section">
      <div class="azimuth-section-title">
        WGS-84 –ì—Ä–∞–¥—É—Å–∏ –•–≤–∏–ª–∏–Ω–∏ –°–µ–∫—É–Ω–¥–∏
      </div>

      <div class="azimuth-grid">
        <input placeholder="–® WGS84 ¬∞">
        <input placeholder="–® WGS84 '">
        <input placeholder='–® WGS84 "'>

        <input placeholder="–î WGS84 ¬∞">
        <input placeholder="–î WGS84 '">
        <input placeholder='–î WGS84 "'>
      </div>
    </div>

    <!-- WGS-84 Decimal -->
    <div class="azimuth-section">
      <div class="azimuth-section-title">
        WGS-84 –î–µ—Å—è—Ç–∫–æ–≤—ñ –≥—Ä–∞–¥—É—Å–∏
      </div>

      <input class="azimuth-wide" placeholder="–®–∏—Ä–æ—Ç–∞ WGS-84 (Google Maps)">
      <input class="azimuth-wide" placeholder="–î–æ–≤–≥–æ—Ç–∞ WGS-84 (Google Maps)">
    </div>

    <!-- Footer -->
    <div class="azimuth-footer">
      <span class="azimuth-link">–ü–æ—Ç–æ—á–Ω–∞ –ø–æ–∑–∏—Ü—ñ—è</span>
      <span class="azimuth-link">–í–∏–±—Ä–∞—Ç–∏ –Ω–∞ –º–∞–ø—ñ</span>
      <button class="azimuth-apply" type="button">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
    </div>

  </div>
</div>
<div class="azimuth-overlay" id="azimuthSettingsOverlay">
  <div class="azimuth-modal">

    <div class="azimuth-title">
      –ê–∑–∏–º—É—Ç–∞–ª—å–Ω–∞ —Å—ñ—Ç–∫–∞
      <div style="font-size:13px;opacity:.7;margin-top:2px">–õ—É—á—ñ</div>
    </div>

   <!-- –î–∞–ª—å–Ω–æ—Å—Ç—å -->
<div class="azimuth-section">
  <div class="azimuth-row-title">
    –î–∞–ª—å–Ω—ñ—Å—Ç—å <b id="azimuth-radius-text">200 –∫–º</b>
  </div>
  <input
    id="azimuth-radius"
    type="range"
    min="1"
    max="1000"
    value="200">
</div>

<!-- –ò–Ω—Ç–µ—Ä–≤–∞–ª -->
<div class="azimuth-section">
  <div class="azimuth-row-title">
    –Ü–Ω—Ç–µ—Ä–≤–∞–ª <b id="azimuth-step-text">10 –∫–º</b>
  </div>
  <input
    id="azimuth-step"
    type="range"
    min="1"
    max="100"
    value="10">
</div>


    <!-- –õ–µ–≥–µ–Ω–¥–∞ -->
    <div class="azimuth-toggle">
      <span>–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –ª–µ–≥–µ–Ω–¥—É</span>
<label class="azimuth-switch">
  <input type="checkbox" id="azimuth-legend" checked>
  <span class="azimuth-slider"></span>
</label>

    </div>

    <!-- Footer -->
    <div class="azimuth-footer">
      <span class="azimuth-link" id="azimuthCancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</span>
      <span class="azimuth-link azimuth-apply">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</span>
    </div>

  </div>
</div>

<input id="azimuth-radius" type="range" min="1" max="1000" value="200">
<input id="azimuth-step"   type="range" min="1" max="100"  value="10">

  <span class="menu-text">ver 1600 (1.6.2)</span>
    <!-- Modal Elements -->
    <div class="modal-background" id="modalBackground"></div>
    <div class="modal" id="speedModal">
        <h2><i class="fas fa-tachometer-alt"></i> –í–≤–µ–¥–∏—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—ä–µ–∫—Ç–∞ (–∫–º/—á):</h2>
        <input type="text" id="speedInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å" />
        <button class="modal-button" id="speedSubmit"><i class="fas fa-check"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        <button class="modal-button modal-close" id="speedClose"><i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div class="modal-background" id="modalBackground"></div>
    <div class="modal" id="targetModal">
        <h2><i class="fas fa-map-marker-alt"></i> –í–≤–µ–¥–∏—Ç–µ —Ü–µ–ª—å (–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä: 53.9,27.5667):</h2>
        <input type="text" id="targetInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã" />
        <button class="modal-button" id="targetSubmit"><i class="fas fa-check"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        <button class="modal-button modal-close" id="targetClose"><i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
                  <div class="dynamic-zoom" id="zoom-buttons">
<button id="zoom-out"><span class="minus">‚Äì</span></button>
    <button id="zoom-in">+</button>
  </div>
    <div id="alert-container">
  <div id="alert-menu">
    <h3>–î–∞—Ç—å —Ç—Ä–µ–≤–æ–≥—É</h3>
    <div><input type="checkbox" id="–°—É–º—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–°—É–º—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–°—É–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–≥.–ö–∏—ó–≤"><label for="–≥.–ö–∏—ó–≤">–≥.–ö–∏–µ–≤</label></div>
    <div><input type="checkbox" id="–•–∞—Ä–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–•–∞—Ä–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–•–∞—Ä—å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–ß–µ—Ä–Ω—ñ–≥—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–ß–µ—Ä–Ω—ñ–≥—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–ß–µ—Ä–Ω–∏–≥–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–ü–æ–ª—Ç–∞–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–ü–æ–ª—Ç–∞–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–ü–æ–ª—Ç–∞–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–î–Ω–µ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–ö–∏—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–ö–∏—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–ö–∏–µ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–ñ–∏—Ç–æ–º–∏—Ä—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–ñ–∏—Ç–æ–º–∏—Ä—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–ñ–∏—Ç–æ–º–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–ß–µ—Ä–∫–∞—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–ß–µ—Ä–∫–∞—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–ß–µ—Ä–∫–∞—Å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–õ—É–≥–∞–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–õ—É–≥–∞–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–õ—É–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–î–æ–Ω–µ—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–î–æ–Ω–µ—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–î–æ–Ω–µ—Ü–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–ö—ñ—Ä–æ–≤–æ–≥—Ä–∞–¥—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–ö—ñ—Ä–æ–≤–æ–≥—Ä–∞–¥—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–ö–∏—Ä–æ–≤–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–í—ñ–Ω–Ω–∏—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–í—ñ–Ω–Ω–∏—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–í–∏–Ω–Ω–∏—Ü–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–ß–µ—Ä–Ω—ñ–≤–µ—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–ß–µ—Ä–Ω—ñ–≤–µ—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–ß–µ—Ä–Ω–æ–≤–∏—Ü–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–•–µ—Ä—Å–æ–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–•–µ—Ä—Å–æ–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–•–µ—Ä—Å–æ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–ê–† –ö—Ä–∏–º"><label for="–ê–† –ö—Ä–∏–º">–ê–† –ö—Ä—ã–º</label></div>
    <div><input type="checkbox" id="–û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–û–¥–µ—Å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–ú–∏–∫–æ–ª–∞—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–ú–∏–∫–æ–ª–∞—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–ù–∏–∫–æ–ª–∞–µ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–•–º–µ–ª—å–Ω–∏—Ü–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–†—ñ–≤–Ω–µ–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–†—ñ–≤–Ω–µ–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–†–æ–≤–Ω–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–¢–µ—Ä–Ω–æ–ø—ñ–ª—å—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–¢–µ—Ä–Ω–æ–ø—ñ–ª—å—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–¢–µ—Ä–Ω–æ–ø–æ–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–ò–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–ó–∞–∫–∞—Ä–ø–∞—Ç—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–ó–∞–∫–∞—Ä–ø–∞—Ç—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–ó–∞–∫–∞—Ä–ø–∞—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–í–æ–ª–∏–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–í–æ–ª–∏–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–í–æ–ª—ã–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–õ—å–≤—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–õ—å–≤—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–õ—å–≤–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–ó–∞–ø–æ—Ä—ñ–∑—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"><label for="–ó–∞–ø–æ—Ä—ñ–∑—å–∫–∞ –æ–±–ª–∞—Å—Ç—å">–ó–∞–ø–æ—Ä–æ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label></div>
    <div><input type="checkbox" id="–ü–æ –≤—Å–µ–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏"><label for="–ü–æ –≤—Å–µ–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏">–ü–æ –≤—Å–µ–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏</label></div>
  </div>
  </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-measure/3.1.0/leaflet-measure.js"></script>
    <script src="https://unpkg.com/leaflet-geosearch/dist/bundle.min.js"></script>
    <script
    src="https://cdn.jsdelivr.net/gh/gokertanrisever/leaflet-ruler@master/src/leaflet-ruler.js"
    integrity="sha384-8SqKZR7V8uOetpjjbcNJHvwuHpb074WS0UXjCLhzfJUqYn3B/uWx1WVv5mwRp1mV"
    crossorigin="anonymous"
></script>
    <script>
      
        const map = L.map('map', {
            zoomControl: false,
             minZoom: 3, // ‚¨ÖÔ∏è –¥–∞–ª—å—à–µ –æ—Ç–¥–∞–ª—è—Ç—å—Å—è –Ω–µ–ª—å–∑—è
               maxZoom: 19
        }).setView([48.3794, 31.1656], 6);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
        }).addTo(map);
map.on('zoom move', () => {
  azimuthSvgLabels.forEach(i =>
    updateAzimuthSvgLabelPosition(i.latlng, i.el)
  );

azimuthDistanceLabels.forEach(i => {
  const p = map.latLngToLayerPoint(i.latlng);

  i.el.setAttribute('x', p.x + 8); // ‚¨Ö –≤—Å–µ–≥–¥–∞ —Å–ø—Ä–∞–≤–∞ –æ—Ç –ª–∏–Ω–∏–∏
  i.el.setAttribute('y', p.y);

  if (i.isOuter) {
    i.el.style.display = 'block';
  } else {
    i.el.style.display = map.getZoom() >= 8 ? 'block' : 'none';
  }
});

});


              const watermark = L.DomUtil.create(
        "div",
        "leaflet-watermark",
        map.getContainer()
      );
let frontLineLayer = null;
let occLayer = null;

      L.DomEvent.disableClickPropagation(watermark);
      L.DomEvent.disableScrollPropagation(watermark);
// –û–±—ã—á–Ω—ã–π OSM (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞)
const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,

    attribution: '¬© OpenStreetMap contributors'
});

// OSM —Å CSS-—Ñ–∏–ª—å—Ç—Ä–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–Ω–æ-–±–µ–ª—ã–º)
const osmGrayLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    className: 'map-tiles', // –ö–ª–∞—Å—Å, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä
    attribution: '¬© OpenStreetMap contributors'
});


// –ß–µ—Ä–Ω–∞—è OSM-–∫–∞—Ä—Ç–∞ (CartoDB Dark Matter)
const darkLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    maxZoom: 19,
    attribution: '¬© <a href="https://carto.com/">CARTO</a>'
});

// –°–ø—É—Ç–Ω–∏–∫–æ–≤–∞—è –∫–∞—Ä—Ç–∞ —Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ (Esri World Imagery with Labels)
const satelliteLayerWithBorders = L.layerGroup([
    L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        maxZoom: 19,
        attribution: 'Tiles ¬© Esri ‚Äî Source: Esri, i-cubed, USDA, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
    }),
    L.tileLayer('https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}', {
        maxZoom: 19,
        attribution: 'Boundaries and labels ¬© Esri'
        
    })
    
]);
var Stadia_AlidadeSmoothDark = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.{ext}', {
	minZoom: 0,
	maxZoom: 20,
	attribution: '&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
	ext: 'png'
});

const googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{
        maxZoom: 20,
        subdomains:['mt0','mt1','mt2','mt3']
        
});

googleHybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{
        maxZoom: 20,
        subdomains:['mt0','mt1','mt2','mt3']
});

googleHybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{
        maxZoom: 20,
        subdomains:['mt0','mt1','mt2','mt3']
});
googleTerrain = L.tileLayer('http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}',{
        maxZoom: 20,
        subdomains:['mt0','mt1','mt2','mt3']
});
googleTerrainGray = L.tileLayer('http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}',{
        maxZoom: 20,
        className: 'map-tiles', // –ö–ª–∞—Å—Å, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä
        subdomains:['mt0','mt1','mt2','mt3']
});
var OpenTopoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
	maxZoom: 17,
	attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
});

var OPNVKarte = L.tileLayer('https://tileserver.memomaps.de/tilegen/{z}/{x}/{y}.png', {
	maxZoom: 18,
	attribution: 'Map <a href="https://memomaps.de/">memomaps.de</a> <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
});
var Esri_WorldTopoMap = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community'
});
var Stadia_OSMBright = L.tileLayer('https://tiles.stadiamaps.com/tiles/osm_bright/{z}/{x}/{y}{r}.{ext}', {
	minZoom: 0,
	maxZoom: 20,
	attribution: '&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
	ext: 'png'
});

// —Ç–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Å–ª–æ–π
let currentBaseLayer = osmLayer;

// —Å–ª–æ–≤–∞—Ä—å —Å–ª–æ—ë–≤
const MAP_LAYERS = {
  osm: osmLayer,
  osmGray: osmGrayLayer,
  satellite: satelliteLayerWithBorders,
  googleStreets: googleStreets,
  googleHybrid: googleHybrid,
  googleTerrain: googleTerrain,
  openTopo: OpenTopoMap,
  googleTerrainGray: googleTerrainGray
};

        let currentObjectId = 9500;
        let deleteMode = false;
        const markers = [];

        function calculateCourse(lat1, lng1, lat2, lng2) {
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const lat1Rad = lat1 * Math.PI / 180;
            const lat2Rad = lat2 * Math.PI / 180;

            return Math.atan2(
                Math.sin(dLng) * Math.cos(lat2Rad),
                Math.cos(lat1Rad) * Math.sin(lat2Rad) - 
                Math.sin(lat1Rad) * Math.cos(lat2Rad) * Math.cos(dLng)
            );
        }

        function calculateNewPosition(lat, lng, speed, time, targetLat, targetLng) {
            const distance = (speed / 3600) * time;
            const earthRadius = 6371;
            const bearing = calculateCourse(lat, lng, targetLat, targetLng);

            const latRadians = (lat * Math.PI) / 180;
            const lngRadians = (lng * Math.PI) / 180;

            const newLatRadians = Math.asin(
                Math.sin(latRadians) * Math.cos(distance / earthRadius) + 
                Math.cos(latRadians) * Math.sin(distance / earthRadius) * Math.cos(bearing)
            );

            const newLngRadians =
                lngRadians +
                Math.atan2(
                    Math.sin(bearing) * Math.sin(distance / earthRadius) * Math.cos(latRadians),
                    Math.cos(distance / earthRadius) - Math.sin(latRadians) * Math.sin(newLatRadians)
                );

            return [
                (newLatRadians * 180) / Math.PI,
                (newLngRadians * 180) / Math.PI
            ];
        }
        

        function haversine(lat1, lng1, lat2, lng2) {
            const R = 6371;
            const dLat = ((lat2 - lat1) * Math.PI) / 180;
            const dLng = ((lng2 - lng1) * Math.PI) / 180;

            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos((lat1 * Math.PI) / 180) *
                Math.cos((lat2 * Math.PI) / 180) *
                Math.sin(dLng / 2) * Math.sin(dLng / 2);

            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        function generateId() {
            return currentObjectId++;
        }
let markersCount = 0;

        // Show modal and handle speed input
        function showSpeedModal(callback) {
            const modal = document.getElementById('speedModal');
            const modalBackground = document.getElementById('modalBackground');
            const speedInput = document.getElementById('speedInput');
            const submitButton = document.getElementById('speedSubmit');
            const closeButton = document.getElementById('speedClose');
            
            modal.classList.add('show');
            modalBackground.style.display = 'none';

            submitButton.onclick = () => {
                const speed = parseFloat(speedInput.value);
                if (!isNaN(speed)) {
                    callback(speed);
                    closeModal();
                } else {
                    alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å!');
                }
            };

            closeButton.onclick = closeModal;

            function closeModal() {
                modal.classList.remove('show');
                modalBackground.style.display = 'none';
                closeModal = ""
            }

            modal.classList.add('show');
            modalBackground.style.display = 'none';
        }

        // Show modal and handle target input
        function showTargetModal(callback) {
            const modal = document.getElementById('targetModal');
            const modalBackground = document.getElementById('modalBackground');
            const targetInput = document.getElementById('targetInput');
            const submitButton = document.getElementById('targetSubmit');
            const closeButton = document.getElementById('targetClose');
            
            modal.classList.add('show');
            modalBackground.style.display = 'block';

            submitButton.onclick = () => {
                const [targetLat, targetLng] = targetInput.value.split(',').map(coord => parseFloat(coord));
                if (!isNaN(targetLat) && !isNaN(targetLng)) {
                    callback(targetLat, targetLng);
                    closeModal();
                } else {
                    alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–ª–∏!');
                }
            };

            closeButton.onclick = closeModal;

            function closeModal() {
                modal.classList.remove('show');
                modalBackground.style.display = 'none';
            }
        }
let addMode = true;
const addPointBtn = document.getElementById('addPointBtn');

addPointBtn.addEventListener('click', () => {
    addMode = !addMode; // –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å

    // –í–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–∫–∞–∂–µ–º, –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ –∫–Ω–æ–ø–∫–∞
    addPointBtn.classList.toggle('active', addMode);
});

        map.on('click', (e) => {
            if (deleteMode) return;
    if (!addMode) return;   // üëà —Ä–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ –∞–∫—Ç–∏–≤–Ω–∞ –∫–Ω–æ–ø–∫–∞

            const { lat, lng } = e.latlng;

            // Get speed input via modal
            showSpeedModal((speed) => {
                // Get target input via modal
                showTargetModal((targetLat, targetLng) => {

                      const objectId = generateId();
            let iconUrl;
let iconClass = "red-id";
let shiftedClass = "";
let currentStyle = 'pomelo'; // pomelo | mariupol | bandera
let showRLSName = true;
const visibleMarkersLayer = L.layerGroup().addTo(map);
const allMarkers = []; // —Ç—É—Ç —Ö—Ä–∞–Ω–∏–º –í–°–ï –º–∞—Ä–∫–µ—Ä—ã

let shiftedClasss = "";

            if (speed === 0) { 
                
    // –ï—Å–ª–∏ —Å–∫–æ—Ä–æ—Å—Ç—å 0, —Å—Ä–∞–∑—É —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É EPVO
    iconUrl = 'EPVO.png'; 
    iconClass = 'eppo';  

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –æ—Ç 500000 –∏ –≤—Ä–µ–º—è –ø–æ –ú–∏–Ω—Å–∫—É
    const objectId1 = getNextObjectId(); 
    const kievTime = getKievTime();

    // –ú–µ–Ω—è–µ–º iconHtml –ü–û–õ–ù–û–°–¢–¨–Æ
    iconHtml = `
  <div class="icon-container1 ${iconClass}">
            <img src="${iconUrl}" class="icon" />
            <div class="info-container1 ${shiftedClass} ${shiftedClasss}">
            </div>
                        </div>
        </div>
  `;
                icon = L.divIcon({
        className: 'icon',
        html: iconHtml,
        iconSize: [6.5, 6.5], // –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä
        iconAnchor: [10, 8],
    });
} else {

// –£—Å–ª–æ–≤–∏—è –≤—ã–±–æ—Ä–∞ –∏–∫–æ–Ω–∫–∏ –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏
if (speed >= 120 && speed <= 121) {
    iconUrl = 'supercam.png';

} else if (speed > 120 && speed <= 200) {

    // —Å–ª—É—á–∞–π –∏–∫–æ–Ω–∫–∏ ‚Äî —Å–æ–∑–¥–∞—ë–º —Å–ª—É—á–∞–π 1 —Ä–∞–∑
    const random = Math.random();
    iconUrl = random < 0.3 ? 'neyst tip.png' : 'shahed.png';

} else if (speed >= 6000 && speed < 8000) {
    const random = Math.random();
    iconUrl = random < 0.7 ? 'neyst tip.png' : 'iskander.png';

} else if (speed >= 950 && speed <= 951) {
    iconUrl = 'kalibr.png';
    iconClass = 'kr';
    } else if (speed >= 1000 && speed <= 1001) {
        iconUrl = 'x101.png';
        iconClass = 'kr';
    } else if (speed >= 450 && speed <= 459) {
        iconUrl = 'kab.png';
    } else if (speed >= 11024 && speed <= 11025) {
        iconUrl = 'Tsirkon.png';
    } else if (speed >= 14687 && speed <= 14688) {
        iconUrl = 'Kinzhal.png';
    } else if (speed >= 4899 && speed <= 4900) {
        iconUrl = 'Kh-22.png';
    } else if (speed >= 1049 && speed <= 1050) {
        shiftedClass = 'shifted-info-container';
        iconUrl = 'Kh-59.png';
        iconClass = 'kr';
    } else if (speed >= 80 && speed <= 85) {
        iconUrl = 'parodia.png';
    } else if (speed >= 290 && speed <= 291) {
        iconUrl = 'Lancet.png';
    } else if (speed >= 98 && speed <= 99) {
        iconUrl = 'gerbera.png';
    } else if (speed >= 118 && speed <= 119) {
        iconUrl = 'ZZala.png';
    } else if (speed >= 4500 && speed <= 4501) {
        iconUrl = 'grumble.png';
        shiftedClass = 'shifted-info-container';
    } else if (speed >= 1030 && speed <= 1031) {
        shiftedClass = 'shifted-info-container';
        iconUrl = 'kh-69.png';
    } else if (speed >= 109 && speed <= 110) {
        iconUrl = 'orlan.png';
    } else if (speed >= 5400 && speed <= 5401) {
        iconUrl = 'atacms.png';
        shiftedClass = 'shifted-info-container';
        iconClass = 'blue-id'; // –°–∏–Ω–∏–π ID –¥–ª—è ATACMS
        lineColor = '#006aff';  // Set blue line color for blue objects
    } else if (speed >= 959 && speed <= 960) {
        iconUrl = 'storm-shadow.png';
        shiftedClass = 'shifted-info-container';
        iconClass = 'zl';
        lineColor = '#006aff';  // Set blue line color for blue objects
    } else if (speed >= 190 && speed <= 191) {
        iconUrl = 'lutiy.png';
        iconClass = 'zl';
        lineColor = '#006aff';  // Set blue line color for blue objects
    } else if (speed >= 201 && speed <= 202) {
        iconUrl = 'beaver.png';
        iconClass = 'zl';
        lineColor = '#006aff';  // Set blue line color for blue objects
    } else if (speed >= 329 && speed <= 330) {
        iconUrl = 'rys`.png';
        iconClass = 'zl';
        lineColor = '#006aff';  // Set blue line color for blue objects
    } else if (speed >= 74 && speed <= 75) {
        iconUrl = 'Molnia.png';
    } else if (speed >= 3000 && speed <= 3001) {
        iconUrl = 'gmlrs.png';
        shiftedClass = 'shifted-info-container';
        iconClass = 'blue-id';
    } else if (speed >= 900 && speed <= 901) {
        iconUrl = 'iskanderk.png';
        iconClass = 'kr';
        shiftedClass = 'shifted-info-container';
    } else if (speed >= 2519 && speed <= 2520) {
        iconUrl = 'kh31.png';
        shiftedClass = 'shifted-info-container';
    } else if (speed >= 1100 && speed <= 1101) {
        iconUrl = 'su-24.png';
    } else if (speed >= 1102 && speed <= 1103) {
        iconUrl = 'su-24 BLR.png';
        iconClass = 'blue-id';
    } else if (speed >= 1002 && speed <= 1003) {
        iconUrl = 'f-16.png';
        iconClass = 'blue-id';
    } else if (speed >= 800 && speed <= 801) {
        iconUrl = 'Su-34.png';
        iconClass = 'red-id su34-icon';
    } else if (speed >= 815 && speed <= 816) {
        iconUrl = 'Su-57.png';
    } else if (speed >= 820 && speed <= 821) {
        iconUrl = 'Su-30.png';
    } else if (speed >= 1202 && speed <= 1203) {
        iconUrl = 'Su-30 BLR.png';
        iconClass = 'blue-id';  
    } else if (speed >= 840 && speed <= 840) {
        iconUrl = 'Su-35.png';
    } else if (speed >= 700 && speed <= 701) {
        iconUrl = 'Tu-22M3.png';
    } else if (speed >= 952 && speed <= 953) {
         iconUrl = 'Su25.png';
    } else if (speed >= 954 && speed <= 955) {
        iconUrl = 'Su25 BLR.png';
        iconClass = 'blue-id';  
    } else if (speed >= 850 && speed <= 851) {
        iconUrl = 'mig-29 BLR.png';
        iconClass = 'blue-id';  
    } else if (speed >= 961 && speed <= 962) {
         iconUrl = 'kh-35.png';
         iconClass = 'kr';
         shiftedClass = 'shifted-info-container';
    } else if (speed >= 3180 && speed <= 3181) {
        iconUrl = 'oniks.png';
        shiftedClass = 'shifted-info-container';
    } else if (speed >= 500 && speed <= 501) {
        iconUrl = 'shahed 238.png';
    } else if (speed >= 920 && speed <= 921) {
        iconUrl = 'mig-31.png';
    } else if (speed >= 800 && speed <= 801) {
        iconUrl = 'a-50.png';
    } else if (speed >= 880 && speed <= 881) {
        iconUrl = 'litak.png';
        iconClass = 'litak-id'; 
    } else if (speed >= 1110 && speed <= 1111) {
        iconUrl = 'mirage.png';
        iconClass = 'blue-id';  
    } else if (speed >= 300 && speed <= 301) {
        iconUrl = 'bplaper.png';
            iconClass = 'perexop';  
    } else if (speed >= 205 && speed <= 250) {
        iconUrl = 'vertolet.png';
        iconClass = 'vertolet';  
    } else if (speed >= 790 && speed <= 791) {
        iconUrl = 'mig-29.png';
    } else {
        // –ï—Å–ª–∏ —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–µ –ø–æ–ø–∞–ª–∞ –Ω–∏ –≤ –æ–¥–Ω–æ —É—Å–ª–æ–≤–∏–µ, —Å—Ç–∞–≤–∏–º "neyst tip.png"
        iconUrl = 'neyst tip.png';
    }
      const objectId2 = getNextObjectIdBlue();
      const isStyleVal = document.body.classList.contains('style-val');
    if (!window._markerIconMemory) window._markerIconMemory = {};
    const key = `${lat}-${lng}-${speed}`;

    if (!window._markerIconMemory[key]) {
        window._markerIconMemory[key] = iconUrl;  // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ–¥–∏–Ω —Ä–∞–∑
    }

    iconUrl = window._markerIconMemory[key];       // –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ç–∏–ø
    // -----------------------------------------

    
    if (iconUrl === 'litak.png') {
        const objectId3 = getNextLitakId();
        iconClass = 'zl-id';
        iconHtml = `
            <div class="icon-container ${iconClass}">
                <img src="${iconUrl}" class="icon" />
                <div class="info-container ${shiftedClass} ${shiftedClasss}">
<span class="label-container ${iconClass}" data-id="${objectId3}">
  0${objectId3}
</span>

                    <span class="r-container ${iconClass}">–õ–ë¬∑</span>
                </div>
            </div>
        `;
                icon = L.divIcon({
            className: 'icon',
                className: 'scalable-marker',
            html: iconHtml,
            iconSize: [24.1, 24.1],
            iconAnchor: [12.05, 12.05],
        });
} else if (iconClass === 'kr') {

    iconUrl = 'kalibr.png';
    iconClass = 'red-id';

        iconHtml = `
          <div class="icon-container ${iconClass}">
            <img src="${iconUrl}" class="icon" />
            <div class="info-container ${shiftedClass} ${shiftedClasss}">
<span class="label-container ${iconClass}" data-id="${objectId}">
  ${objectId}
</span>
              <span class="r-container ${iconClass}">–ü–ü¬∑</span>
            </div>
          </div>
        `;

    icon = L.divIcon({
        className: 'icon',
            className: 'scalable-marker',
        html: iconHtml,
        iconSize: [28.8, 28.8],
        iconAnchor: [14.4, 14.4],
    });

    } else if (iconClass === 'blue-id') {
        iconUrl = 'blue.png';
        iconHtml = `
            <div class="icon-container ${iconClass}">
                <img src="${iconUrl}" class="icon" />
                <div class="info-container ${shiftedClass} ${shiftedClasss}">
<span class="label-container ${iconClass}" data-id="${objectId2}">
  0${objectId2}
</span>

                    <span class="r-container ${iconClass}">–°–í¬∑</span>
                </div>
            </div>
        `;
        icon = L.divIcon({
            className: 'icon',
                className: 'scalable-marker',
            html: iconHtml,
            iconSize: [24.1, 24.1],
            iconAnchor: [12.05, 12.05],
        });
    } else if (iconClass === 'vertolet') {
        iconClass = 'blue-id';
        iconHtml = `
            <div class="icon-container ${iconClass}">
                <img src="${iconUrl}" class="icon" />
                <div class="info-container ${shiftedClass} ${shiftedClasss}">
<span class="label-container ${iconClass}" data-id="${objectId2}">
  0${objectId2}
</span>

                    <span class="r-container ${iconClass}">–°–í¬∑</span>
                </div>
            </div>
        `;
        icon = L.divIcon({
            className: 'icon',
                className: 'scalable-marker',
            html: iconHtml,
            iconSize: [24.1, 24.1],
            iconAnchor: [12.05, 12.05],
        });
    } else if (iconClass === 'zl') {
                                iconUrl = 'zl.png';
                                  iconClass = 'zl-id';

        iconHtml = `
            <div class="icon-container ${iconClass}">
                <img src="${iconUrl}" class="icon" />
                <div class="info-container ${shiftedClass} ${shiftedClasss}">
<span class="label-container ${iconClass}" data-id="${objectId2}">
  0${objectId2}
</span>
                    <span class="r-container ${iconClass}">–ó–õ¬∑</span>
                </div>
            </div>
        `;
        icon = L.divIcon({
            className: 'icon',
                className: 'scalable-marker',
            html: iconHtml,
            iconSize: [24.1, 24.1],
            iconAnchor: [12.05, 12.05],
        });
            } else if (iconClass === 'perexop') {
              iconClass = 'zl-id';
        iconHtml = `
            <div class="icon-container ${iconClass}">
                <img src="${iconUrl}" class="icon" />
                <div class="info-container ${shiftedClass} ${shiftedClasss}">
<span class="label-container ${iconClass}" data-id="${objectId2}">
  0${objectId2}
</span>

                    <span class="r-container ${iconClass}">–ó–õ¬∑</span>
                </div>
            </div>
        `;
        icon = L.divIcon({
            className: 'icon',
                className: 'scalable-marker',
            html: iconHtml,
            iconSize: [24.1, 24.1],
            iconAnchor: [12.05, 12.05],
        });
    } else {
        const iconTypes = {
            "shahed 238.png": "–£–¥–∞—Ä–Ω–∏–π –¥—Ä–æ–Ω",
            "shahed.png": "–£–¥–∞—Ä–Ω–∏–π –¥—Ä–æ–Ω",
            "–∫—Ä.png": "–ö—Ä–∏–ª–∞—Ç–∞ —Ä–∞–∫–µ—Ç–∞"
        };

        const iconName = iconTypes[iconUrl] || "–ù–µ–≤—ñ–¥–æ–º–∏–π –æ–±'—î–∫—Ç";
        const randomNumber = Math.floor(Math.random() * 200) + 1;

        iconHtml = `
            <div class="icon-container ${iconClass}">
                <img src="${iconUrl}" class="icon" />
                <div class="info-container ${shiftedClass} ${shiftedClasss}">
<span class="label-container ${iconClass}" data-id="${objectId}">
  ${objectId}
</span>
                    <span class="r-container ${iconClass}">–ü–ü¬∑</span>

                </div>
            </div>
        `;
        icon = L.divIcon({
            className: 'icon',
                className: 'scalable-marker',
            html: iconHtml,
            iconSize: [24.1, 24.1],
            iconAnchor: [12.05, 12.05],
        });
    }
}


let iconCreated = false;
function addSpeedCircle(marker, speed) {
    let color = null;

    if (speed > 4000) {
        color = "#ff6a00";
    } else if (speed >= 2000) {
        color = "#ffea70";
    } else {
        return null;
    }

    const latlng = marker.getLatLng();
    const circle = L.circleMarker(latlng, {
        radius: 16,
        stroke: false,
        fillColor: color,
        fillOpacity: 0.5,
    }).addTo(map);

    marker.on("move", () => {
        circle.setLatLng(marker.getLatLng());
    });

    return circle;
}

const marker = L.marker([lat, lng], { icon }).addTo(map);
allMarkers.push(marker);
marker._trueOriginalIconHtml = iconHtml; // –Ω–∞—Å—Ç–æ—è—â–∏–π
marker._originalIconHtml = iconHtml;     // —Ä–∞–±–æ—á–∏–π (–±—É–¥–µ–º –º–µ–Ω—è—Ç—å)
markersCount++;
updateAlertButton();
// –µ—Å–ª–∏ —É –º–∞—Ä–∫–µ—Ä–∞ —É–∂–µ –±—ã–ª –∫—Ä—É–≥ ‚Äî —É–¥–∞–ª—è–µ–º
if (marker._speedCircle) {
    map.removeLayer(marker._speedCircle);
}

marker._speedCircle = addSpeedCircle(marker, speed);

const translations = {
    "supercam": "Supercam",
    "shahed": "Shahed",
    "iskander": "–ò—Å–∫–∞–Ω–¥–µ—Ä-–ú",
    "kalibr": "–ö–∞–ª–∏–±—Ä",
    "x101": "–•-101",
    "kab": "–ö–ê–ë",
    "Tsirkon": "–¶–∏—Ä–∫–æ–Ω",
    "Kinzhal": "–ö–∏–Ω–∂–∞–ª",
    "Kh-22": "–•-22",
    "Kh-59": "–•-59",
    "parodia": "–ü–∞—Ä–æ–¥–∏—è",
    "Lancet": "–õ–∞–Ω—Ü–µ—Ç",
    "gerbera": "–ì–µ—Ä–±–µ—Ä–∞",
    "ZZala": "–ó–∞–ª–∞",
    "grumble": "–ó–£–†",
    "kh-69": "–•-69",
    "orlan": "–û—Ä–ª–∞–Ω",
    "atacms": "ATACMS",
    "storm-shadow": "Storm Shadow",
    "lutiy": "–õ—é—Ç—ã–π",
    "beaver": "–ë–æ–±—ë—Ä",
    "rys`": "–†—ã—Å—å",
    "Molnia": "–ú–æ–ª–Ω–∏—è",
    "gmlrs": "GMLRS",
    "iskanderk": "–ò—Å–∫–∞–Ω–¥–µ—Ä-–ö",
    "kh31": "–•-31",
    "su-24": "–°—É-24",
    "f-16": "F-16",
    "Su-34": "–°—É-34",
    "Su-57": "–°—É-57",
    "su-30": "–°—É-30",
    "Su-30 BLR": "–°—É-30 (–ë–µ–ª–∞—Ä—É—Å—å)",
    "Su-35": "–°—É-35",
    "Tu-22M3": "–¢—É-22–ú3",
    "mirage": "Mirage-2000",
    "neyst tip": "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø"
};

let objectKey = iconUrl.replace('.png', '').replace(/-/g, ' ');
let objectType = translations[objectKey] || objectKey;
objectType = objectType.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');

let currentLat = lat;
let currentLng = lng;
let targetLatVar = targetLat;
let targetLngVar = targetLng;
let isActive = true;
let waypoints = [];
let currentWaypointIndex = 0;
let lastTimestamp = null;

/// ==== –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–ª–µ–¥–∞ ====
let showTrail = false;
let trailCoords = [[currentLat, currentLng]];

let trailLine = null;
let startMarker = null;
let trailDecorator = null;
let autoDashedTrail = false;


// ==== –¶–≤–µ—Ç –ª–∏–Ω–∏–∏ ====
function getLineColor(marker) {
    if (!marker || !marker.options || !marker.options.icon) return '#F70300';
    const html = marker.options.icon.options.html || '';
    if (html.includes('shahed')) return '#FDCF00';
    if (html.includes('neyst tip')) return '#006aff';
    return '#F70300';
}
// ==== –¶–≤–µ—Ç —Å–ª–µ–¥–∞ –ø–æ ID –º–∞—Ä–∫–µ—Ä–∞ ====
function getTrailColorById(marker) {
    if (!marker || !marker.options || !marker.options.icon) return '#F70300';

    const html = marker.options.icon.options.html || '';

    if (html.includes('red-id'))  return '#dd0347'; // –∫—Ä–∞—Å–Ω—ã–π
    if (html.includes('blue-id')) return '#2375D8'; // —Å–∏–Ω–∏–π
    if (html.includes('zl')) return '#000000'; // —Å–∏–Ω–∏–π
    if (html.includes('perexop')) return '#000000'; // —Å–∏–Ω–∏–π

    return '#F70300'; // –¥–µ—Ñ–æ–ª—Ç
}function shouldAutoTrail(marker, speed) {
    if (!marker || !marker.options || !marker.options.icon) return false;

    const html = marker.options.icon.options.html || '';

    // ‚ùå –∏—Å–∫–ª—é—á–∞–µ–º blue-id
    if (html.includes('blue-id')) return false;

    // ‚úÖ —Å–∫–æ—Ä–æ—Å—Ç—å –±–æ–ª—å—à–µ 2000 –∫–º/—á
    return speed > 4000;
}function createTrail(marker, forcedColor = null, withStartPoint = true, dashed = false) {
    const lineColor = forcedColor || getLineColor(marker);

    trailLine = L.polyline(trailCoords, {
        color: lineColor,
        weight: 1,
        opacity: 1,
        dashArray: dashed ? '2 3' : null // üëà –ü–£–ù–ö–¢–ò–†
    }).addTo(map);

    if (withStartPoint) {
        startMarker = L.circleMarker(trailCoords[0], {
            radius: 0.2,
            color: lineColor,
            fillColor: lineColor,
            fillOpacity: 1
        }).addTo(map);
    } else {
        startMarker = null;
    }

}
function forceDisableTrail() {
    showTrail = false;
    autoDashedTrail = false;

    if (trailLine) {
        map.removeLayer(trailLine);
        trailLine = null;
    }
    if (startMarker) {
        map.removeLayer(startMarker);
        startMarker = null;
    }
    if (trailDecorator) {
        map.removeLayer(trailDecorator);
        trailDecorator = null;
    }
}



function enableTrail(marker, color = null, withStartPoint = true) {
    // ‚ùå –µ—Å–ª–∏ —ç—Ç–æ –∞–≤—Ç–æ-–ø—É–Ω–∫—Ç–∏—Ä ‚Äî –∫–Ω–æ–ø–∫—É –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
    if (autoDashedTrail) return;

    disableTrail();
    showTrail = true;
    createTrail(marker, color, withStartPoint, false);
}
function disableTrail() {
    // ‚ùå –Ω–µ —Ç—Ä–æ–≥–∞–µ–º –∞–≤—Ç–æ-–ø—É–Ω–∫—Ç–∏—Ä
    if (autoDashedTrail) return;

    showTrail = false;

    if (trailLine) {
        map.removeLayer(trailLine);
        trailLine = null;
    }
    if (startMarker) {
        map.removeLayer(startMarker);
        startMarker = null;
    }
    if (trailDecorator) {
        map.removeLayer(trailDecorator);
        trailDecorator = null;
    }
}

// ==== –î–µ–∫–æ—Ä–∞—Ç–æ—Ä —Å—Ç—Ä–µ–ª–æ–∫ ====
function updateDecorator(lineColor) {
    if (trailDecorator) map.removeLayer(trailDecorator);
    trailDecorator = L.polylineDecorator(trailLine, {
        patterns: [{
            offset: '100%',
            repeat: 0,
            symbol: L.Symbol.arrowHead({
                pixelSize: 4,
                polygon: true,
                pathOptions: { color: lineColor, fillOpacity: 1 }
            })
        }]
    }).addTo(map);
}
if (shouldAutoTrail(marker, speed)) {
    autoDashedTrail = true;   // üëà –í–ê–ñ–ù–û
    showTrail = true;

    createTrail(
        marker,
        getTrailColorById(marker),
        false,
        true
    );
}


// ==== –ö–Ω–æ–ø–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è —Å–ª–µ–¥–∞ ====
function initTrailButton(marker) {
    const btn = document.getElementById("left-arrow-button");
    if (!btn) return console.warn("–ö–Ω–æ–ø–∫–∞ #left-arrow-button –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!");

    btn.addEventListener("click", () => {
        if (!showTrail) {
            // üëâ –∫–Ω–æ–ø–∫–∞ = –°–û —Å—Ç–∞—Ä—Ç–æ–≤–æ–π —Ç–æ—á–∫–æ–π
            enableTrail(marker, getTrailColorById(marker), true);
        } else {
            disableTrail();
        }
    });
}



if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", () => initTrailButton(marker));
} else {
    initTrailButton(marker);
}
function isWarningVisible() {
    const w = document.getElementById('warning-message');
    if (!w) return false;
    return !w.classList.contains('hidden') && w.offsetHeight > 0;
}

// ==== –í–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é ====
// ==== –í–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é ====
function createTopMenu(marker) {
    if (typeof deleteMode !== 'undefined' && deleteMode) return;
    if (document.getElementById('top-menu-' + objectId)) return;

    // ‚úÖ –±–µ—Ä—ë–º safe-top –ò–ó CSS
    const SAFE_TOP = parseInt(
        getComputedStyle(document.documentElement)
            .getPropertyValue('--safe-top')
    ) || 0;

    const menu = document.createElement('div');
    menu.id = 'top-menu-' + objectId;

    // —Å—á–∏—Ç–∞–µ–º, —Å–∫–æ–ª—å–∫–æ —É–∂–µ –µ—Å—Ç—å –ø–∞–Ω–µ–ª–µ–π
    const existingMenus =
        document.querySelectorAll('[id^="top-menu-"]').length;

    // ‚úÖ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π offset —Å —É—á—ë—Ç–æ–º —á—ë—Ä–Ω–æ–π –ø–æ–ª–æ—Å—ã
const baseTop = isWarningVisible() ? 16 : 0;
const offset = baseTop + existingMenus * 36;


    Object.assign(menu.style, {
        position: 'fixed',
        top: offset + 'px',
        left: '0',
        width: '100%',
        height: '36px',
        background: 'rgba(0, 0, 0, 0.4)',
        color: '#fff',
        fontFamily: 'Consolas, monospace',
        fontSize: '15.6px',
        zIndex: '9999',
        borderBottom: '1px solid rgba(255,255,255,0.15)',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'space-between',
        padding: '0 9.6px',
        boxShadow: 'none',
        transition: 'none'
    });

    /* === –¢–ï–ö–°–¢ === */
    const row = document.createElement('div');
Object.assign(row.style, {
  display: 'grid',
  gridTemplateColumns: 'repeat(6, minmax(0, 1fr))',
  alignItems: 'center',
  width: '100%',
  textAlign: 'center',
  letterSpacing: '0.36px',
  columnGap: '14.4px',
  boxSizing: 'border-box'
});
menu.style.paddingRight = '144px';


    row.innerHTML = `
        <div>${objectId}—Ä</div>
        <div>A0</div>
        <div>D0</div>
        <div>H0.0</div>
        <div>V${speed}</div>
        <div>1</div>
    `;

    /* === –ö–ù–û–ü–ö–ò === */
    const icons = document.createElement('div');
    Object.assign(icons.style, {
        position: 'absolute',
        right: '9.6px',
        display: 'flex',
        gap: '14.4px'
    });

    icons.innerHTML = `
        <button id="changeCoordsBtn-${objectId}" title="–ò–∑–º–µ–Ω–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç"
            style="width:26.4px;height:26.4px;border:1px solid rgba(255,255,255,0.25);
                   background: var(--menu-bg);border-radius:2.4px;
                   display:flex;align-items:center;justify-content:center;padding:0;">
            <img src="reload 2.png" style="width:16.8px;height:16.8px;">
        </button>

        <button id="zelenySamBtn-${objectId}" title="–°–∞–º–æ–ª—ë—Ç"
            style="width:26.4px;height:26.4px;border:1px solid rgba(255,255,255,0.25);
                   background: var(--menu-bg);border-radius:2.4px;
                   display:flex;align-items:center;justify-content:center;padding:0;">
            <img src="zelenysam.png" style="width:18px;height:18px;">
        </button>

        <button id="closeTopMenu-${objectId}" title="–ó–∞–∫—Ä—ã—Ç—å"
            style="width:26.4px;height:26.4px;border:1px solid rgba(255,255,255,0.25);
                   background: var(--menu-bg);border-radius:2.4px;
                   display:flex;align-items:center;justify-content:center;padding:0;">
<i class="fas fa-trash-alt trash-icon"></i>
        </button>
    `;

    menu.appendChild(row);
    menu.appendChild(icons);
    document.body.appendChild(menu);
    // –æ–±–Ω–æ–≤–ª–µ–Ω–æ ‚Äî –ª–∏–Ω–∏—è —Ç–µ–ø–µ—Ä—å –∏—Å—á–µ–∑–∞–µ—Ç –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –º–µ–Ω—é
    document.getElementById(`closeTopMenu-${objectId}`).onclick = () => {
            disableTrail();
const isExpanded = marker._expanded;
        // –≤–µ—Ä–Ω—É—Ç—å –∏–∫–æ–Ω–∫—É –≤ –æ–±—ã—á–Ω—ã–π –≤–∏–¥, –µ—Å–ª–∏ –±—ã–ª–∞ —Ä–∞—Å–∫—Ä—ã—Ç–∞
if (marker._expanded) {
    marker.setIcon(L.divIcon({
        className: "icon",
        html: marker._originalIconHtml,
  iconSize: isExpanded ? undefined : ICON_SIZES_BY_STYLE[currentStyle],
        iconAnchor: marker._originalAnchor
    }));
    marker._expanded = false;
}

        menu.remove();
    // –µ—Å–ª–∏ –µ—Å—Ç—å –ª–∏–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è ‚Äî —É–¥–∞–ª–∏—Ç—å
    if (headingLine) {
        map.removeLayer(headingLine);
        headingLine = null;
    }

    // üî• –µ—Å–ª–∏ –∏–∫–æ–Ω–∫–∞ –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ ‚Äî –≤–µ—Ä–Ω—É—Ç—å –∏—Å—Ö–æ–¥–Ω—É—é
if (marker.isExpanded) {
    marker.setIcon(L.divIcon({
        className: 'icon',
        html: iconHtml,
        iconSize: marker._originalSize,
        iconAnchor: marker._originalAnchor,
    }));
    marker.isExpanded = false;
}


        // ‚úÖ –ø–µ—Ä–µ—Ä–∞—Å—á—ë—Ç –≤—Å–µ—Ö –º–µ–Ω—é –° –£–ß–Å–¢–û–ú SAFE-TOP
        const allMenus = document.querySelectorAll('[id^="top-menu-"]');
const baseTop = isWarningVisible() ? 16 : 0;

allMenus.forEach((m, i) => {
    m.style.top = (baseTop + i * 36) + 'px';
});

    };
const warning = document.getElementById('warning-message');

if (warning) {
    const observer = new MutationObserver(() => {
        const baseTop = isWarningVisible() ? 16 : 0;
        const allMenus = document.querySelectorAll('[id^="top-menu-"]');

        allMenus.forEach((m, i) => {
            m.style.top = (baseTop + i * 36) + 'px';
        });
    });

    observer.observe(warning, {
        attributes: true,
        attributeFilter: ['class', 'style']
    });
}

    document.getElementById(`changeCoordsBtn-${objectId}`).onclick = () => {
        openCoordsModal((coordsText) => {
            if (!coordsText) return;
            const coordsList = coordsText
                .split("\n")
                .map(line => line.split(",").map(Number))
                .filter(c => !isNaN(c[0]) && !isNaN(c[1]));
            if (coordsList.length > 0) {
                const pos = marker.getLatLng();
                currentLat = pos.lat;
                currentLng = pos.lng;
                waypoints = [[currentLat, currentLng], ...coordsList];
                currentWaypointIndex = 1;
                targetLatVar = waypoints[1][0];
                targetLngVar = waypoints[1][1];
                lastTimestamp = null;
                if (!isActive) {
                    isActive = true;
                    scheduleNextFrame(updatePosition);
                }
            }
        });
    };
}

// ==== –ö–ª–∏–∫ –ø–æ –º–∞—Ä–∫–µ—Ä—É ====
let headingLine = null;

marker.on('click', () => {
    
    // üõë 1. DELETE MODE ‚Äî –ü–ï–†–í–´–ú
    if (deleteMode) {
        e.originalEvent.stopPropagation();
        e.originalEvent.preventDefault();

        // ‚ùå —É–±—Ä–∞—Ç—å —Å–ª–µ–¥, –µ—Å–ª–∏ –µ—Å—Ç—å
        disableTrail();
        forceDisableTrail();

        // üü° —É–±—Ä–∞—Ç—å –∫—Ä—É–≥ —Å–∫–æ—Ä–æ—Å—Ç–∏
        if (marker._speedCircle) {
            map.removeLayer(marker._speedCircle);
            marker._speedCircle = null;
        }

               if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç?')) {
            marker.remove();
            isActive = false;
                document.getElementById('deleteButton').style.color = 'gray';
            const deleteButton = document.getElementById('deleteButton');
            if (deleteButton) {
                deleteMode = false;
                deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
            }
        }


        return; // ‚õî –í–°–Å, –ù–ò–ß–ï–ì–û –î–ê–õ–¨–®–ï –ù–ï –í–´–ü–û–õ–ù–Ø–ï–ú
    }
    createTopMenu(marker);
    // ‚ùå –±–µ–∑ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π —Ç–æ—á–∫–∏


    // —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã 1 —Ä–∞–∑
if (!marker._saved) {

    // HTML –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª—å–Ω–æ —Å—Ç–æ–∏—Ç —É –º–∞—Ä–∫–µ—Ä–∞
    const iconHtmlThis = marker.options.icon.options.html;

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π HTML
    marker._originalIconHtml = iconHtmlThis;

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä –∏ —è–∫–æ—Ä—å
    marker._originalAnchor = marker.options.icon.options.iconAnchor;
    marker._originalSize   = marker.options.icon.options.iconSize;

    // –†–∞–∑–±–æ—Ä HTML
    const temp = document.createElement("div");
    temp.innerHTML = iconHtmlThis;

    const idEl = temp.querySelector(".label-container");
    const rEl  = temp.querySelector(".r-container");

    marker._originalID = idEl ? idEl.textContent.trim() : "";
    marker._originalR  = rEl  ? rEl.textContent.trim() : "";
marker._originalRLS = getRlsForObject(objectId, iconUrl);

    marker._saved = true; // —á—Ç–æ–±—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–Ω–æ–≤–∞
}

const ICON_TYPES = {
    "shahed.png": "–£–¥–∞—Ä–Ω–∏–π –¥—Ä–æ–Ω",
    "kalibr.png": "–ö—Ä–∏–ª–∞—Ç–∞ —Ä–∞–∫–µ—Ç–∞",
    "Su-35.png": "–°—É-35",
    "Su-34.png": "–°—É-34",
    "Su-30.png": "–°—É-30",
    "Su-57.png": "–°—É-57",
    "orlan.png": "–†–æ–∑–≤—ñ–¥. –¥—Ä–æ–Ω",
    "kab.png": "–ö–ê–ë",
    "iskander.png": "–†–∞–∫–µ—Ç–∞",
    "bplaper.png": "–ë–ø–õ–ê –ø–µ—Ä–µ—Ö–æ–ø.",
    "vertolet.png": "–í–µ—Ä—Ç–æ–ª—ñ—Ç",
    "mig-31.png": "–ú—ñ–ì-31",
    "ZZala.png": "–∑–∞–ª–∞",
    "supercam.png": "–°—É–ø–µ—Ä–∫–∞–º",
    "Tu-22M3.png": "–¢—É-22–ú3",
    "mig-29.png": "–ú—ñ–ì-29–ö",
};
const objectType = ICON_TYPES[iconUrl] || "";

    // ==== –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º ====
    if (!marker._expanded) {

        const angle = marker._lastAngle || 0;

       const expandedHtml = `
<div class="icon-container ${iconClass} expanded ${objectType ? "with-type" : ""}">

    <!-- –ë–õ–û–ö –ò–ö–û–ù–ö–ò ‚Äî –¢–û–õ–¨–ö–û –ö–ê–†–¢–ò–ù–ö–ê -->
    <div class="icon-wrap">
<img src="${iconUrl}" class="icon" />



    </div>

    <!-- –¢–ï–ö–°–¢ ‚Äî –û–¢–î–ï–õ–¨–ù–û -->
    <div class="info-container"
         style="
            display: flex !important;
            flex-direction: column !important;
            align-items: flex-start !important;
            justify-content: flex-start !important;

            padding: 0.8px 4px 0.8px 8px !important;
            min-width: auto !important;
    height: auto !important;
    gap: 0.8px !important;                    /* 1 * 0.83 */
    line-height: 0.9 !important;
    contain: none !important;
             ">
<span class="r-container ${iconClass}">${objectType}</span>
            <div style="display:flex; gap:2px;">
                <span class="label-container ${iconClass}">${marker._originalID}</span>
                <span class="r-container ${iconClass}">${marker._originalR}</span>
            </div>

            <span class="r-container ${iconClass}">${speed}</span>

            <span class="r-container ${iconClass}">${Math.round(angle)}¬∞</span>
<span class="r-container ${iconClass}">
    ${marker._originalRLS}
</span>

        </div>
    </div>
`;


const expandedAnchor = [
    marker._originalAnchor[0],
    marker._originalAnchor[1] + (objectType ? 14.5 : 9.5)
];


        marker.setIcon(L.divIcon({
            className: "icon",
            html: expandedHtml,
            iconSize: marker._originalSize,
            iconAnchor: expandedAnchor
        }));

        marker._expanded = true;
    }

    // ==== –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ ====
    else {

        marker.setIcon(L.divIcon({
            className: "icon",
    html: marker._originalIconHtml,
    iconSize: marker._originalSize,
    iconAnchor: marker._originalAnchor
        }));

        marker._expanded = false;
    }

    if (headingLine) {
        map.removeLayer(headingLine);
        headingLine = null;
        return;
    }

    headingLine = L.polyline([], {
        color: '#999999', // —Å–µ—Ä–∞—è
        weight: 0.8,      // —Ç–æ–Ω—å—à–µ
        opacity: 0.9
    }).addTo(map);
        enableTrail(marker, getTrailColorById(marker), false);
                });
// ==== –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–∏–Ω–∏–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è ====
function updateHeadingLine(angleDeg) {
    if (!headingLine) return;
    const pos = marker.getLatLng();
    const angleRad = angleDeg * Math.PI / 180;
    const lengthMeters = 2000000; // 1000 –∫–º
    const R = 6371000;

    const lat2 = pos.lat + (lengthMeters / R) * (180 / Math.PI) * Math.cos(angleRad);
    const lng2 = pos.lng + (lengthMeters / R) * (180 / Math.PI) * Math.sin(angleRad) / Math.cos(pos.lat * Math.PI / 180);

    headingLine.setLatLngs([[pos.lat, pos.lng], [lat2, lng2]]);
}

// ==== –í—Ä–∞—â–µ–Ω–∏–µ –∏ –¥–≤–∏–∂–µ–Ω–∏–µ ====
function rotateIcon(lat1, lng1, lat2, lng2, speed) {
    if (speed === 0) {
        marker._icon.querySelector('.icon').style.transform = `rotate(0deg)`;
        return;
    }
    const course = calculateCourse(lat1, lng1, lat2, lng2) * (180 / Math.PI);
    const angle = (course + 360) % 360;
    marker._icon.querySelector('.icon').style.transform = `rotate(${angle}deg)`;
    updateHeadingLine(angle);

    // üî• –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û ‚Äî —á—Ç–æ–±—ã –∫—É—Ä—Å –æ–±–Ω–æ–≤–ª—è–ª—Å—è –≤ expandedHtml
    marker._lastAngle = angle;
}   

markers.push(marker);

function scheduleNextFrame(callback) {
    if (document.hasFocus()) requestAnimationFrame(callback);
    else setTimeout(() => { if (isActive) callback(performance.now()); }, 1000);
}

function updatePosition(timestamp) {
    if (!lastTimestamp) lastTimestamp = timestamp;
    const deltaTime = (timestamp - lastTimestamp) / 1000;
    lastTimestamp = timestamp;

    const speedMps = speed * 1000 / 3600;
    let [newLat, newLng] = calculateNewPosition(currentLat, currentLng, speedMps, deltaTime, targetLatVar, targetLngVar);

    const distance = haversine(currentLat, currentLng, targetLatVar, targetLngVar);
    const stepDistance = haversine(currentLat, currentLng, newLat, newLng);

    if (stepDistance >= distance || distance <= 0.00001) {
        currentLat = targetLatVar;
        currentLng = targetLngVar;
        currentWaypointIndex++;

        if (currentWaypointIndex < waypoints.length) {
            targetLatVar = waypoints[currentWaypointIndex][0];
            targetLngVar = waypoints[currentWaypointIndex][1];
            scheduleNextFrame(updatePosition);
        } else {
            isActive = false;

            // ‚ùó –°–ë–†–û–° –ê–í–¢–û–ü–£–ù–ö–¢–ò–†–ê –ü–†–ò –ö–û–ù–¶–ï –ú–ê–†–®–†–£–¢–ê
 forceDisableTrail();


            // –£–¥–∞–ª—è–µ–º –∫—Ä—É–≥ —Å–∫–æ—Ä–æ—Å—Ç–∏
            if (marker._speedCircle) {
                map.removeLayer(marker._speedCircle);
            }

            // –£–¥–∞–ª—è–µ–º –º–∞—Ä–∫–µ—Ä
            marker.remove();

            if (headingLine)
                map.removeLayer(headingLine);
        }
    }

 else {
        currentLat = newLat;
        currentLng = newLng;
        rotateIcon(currentLat, currentLng, targetLatVar, targetLngVar, speed);
        marker.setLatLng([currentLat, currentLng]);
        scheduleNextFrame(updatePosition);
    }

    trailCoords.push([currentLat, currentLng]);
    if (showTrail && trailLine) {
        trailLine.setLatLngs(trailCoords);
        updateDecorator();
    }
}

// ==== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ ====
waypoints.push([targetLat, targetLng]);
currentWaypointIndex = 0;
lastTimestamp = null;
scheduleNextFrame(updatePosition);

// ==== –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ ====
function haversine(lat1, lon1, lat2, lon2) {
    const R = 6371000;
    const toRad = x => x * Math.PI / 180;
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a = Math.sin(dLat/2)**2 +
        Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
        Math.sin(dLon/2)**2;
    return 2 * R * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

function calculateCourse(lat1, lon1, lat2, lon2) {
    const toRad = x => x * Math.PI / 180;
    const y = Math.sin(toRad(lon2 - lon1)) * Math.cos(toRad(lat2));
    const x = Math.cos(toRad(lat1)) * Math.sin(toRad(lat2)) -
              Math.sin(toRad(lat1)) * Math.cos(toRad(lat2)) *
              Math.cos(toRad(lon2 - lon1));
    return Math.atan2(y, x);
}

function calculateNewPosition(lat1, lon1, speedMps, deltaTime, lat2, lon2) {
    const distanceToTravel = speedMps * deltaTime;
    const distanceTotal = haversine(lat1, lon1, lat2, lon2);
    if (distanceToTravel >= distanceTotal) return [lat2, lon2];
    const fraction = distanceToTravel / distanceTotal;
    return [
        lat1 + (lat2 - lat1) * fraction,
        lon1 + (lon2 - lon1) * fraction
    ];
}

// ==== –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ====
function openCoordsModal(callback) {
    const background = document.createElement('div');
    background.className = 'modal-background show';
    document.body.appendChild(background);

    const box = document.createElement('div');
    box.className = 'modal show coords-modal-top-left';
    box.innerHTML = `
        <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞</h2>
        <textarea id="coordsInput" placeholder="–ö–ª–∏–∫–∞–π –∫–æ–ª—ë—Å–∏–∫–æ–º –ø–æ –∫–∞—Ä—Ç–µ" style="width:100%; height:80px; font-size:7px; background:#1e232c; color:#fff; border:1px solid #3a4152; border-radius:4px; padding:3px;"></textarea>
        <button id="coordsOk" class="modal-button">OK</button>
        <button id="coordsCancel" class="modal-button">–û—Ç–º–µ–Ω–∞</button>
    `;
    document.body.appendChild(box);

    box.style.top = '20px';
    box.style.left = '20px';
    box.style.transform = 'none';

    let isDragging = false;
    let offsetX, offsetY;
    box.onmousedown = (e) => {
        if (e.target.tagName === "TEXTAREA" || e.target.tagName === "BUTTON") return;
        isDragging = true;
        offsetX = e.clientX - box.offsetLeft;
        offsetY = e.clientY - box.offsetTop;
        document.onmousemove = (ev) => {
            if (isDragging) {
                box.style.left = ev.clientX - offsetX + "px";
                box.style.top = ev.clientY - offsetY + "px";
            }
        };
        document.onmouseup = () => {
            isDragging = false;
            document.onmousemove = null;
            document.onmouseup = null;
        };
    };

    const textarea = box.querySelector('#coordsInput');
    let tempWaypoints = [marker.getLatLng()];
    let routeLine = L.polyline(tempWaypoints, { color: '#dd0347', weight: 1, opacity: 1 }).addTo(map);

    const addCoord = (e) => {
        if (e.originalEvent.button !== 1) return;
        e.originalEvent.preventDefault();
        const latlng = map.mouseEventToLatLng(e.originalEvent);
        textarea.value += latlng.lat.toFixed(5) + "," + latlng.lng.toFixed(5) + "\n";
        tempWaypoints.push(latlng);
        routeLine.setLatLngs(tempWaypoints);
    };

    map.on('mousedown', addCoord);

    box.querySelector('#coordsOk').onclick = () => {
        map.off('mousedown', addCoord);
        map.removeLayer(routeLine);

        const coordsText = textarea.value.trim();
        callback(coordsText);

        document.body.removeChild(box);
        document.body.removeChild(background);
    };

    box.querySelector('#coordsCancel').onclick = () => {
        map.off('mousedown', addCoord);
        map.removeLayer(routeLine);
        document.body.removeChild(box);
        document.body.removeChild(background);
        callback(null);
    };
}

// ==== –£–¥–∞–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞ –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è –ª–∏–Ω–∏–∏ ====
// ==== –ö–ª–∏–∫ –ø–æ –º–∞—Ä–∫–µ—Ä—É ====
// ==== –ö–ª–∏–∫ –ø–æ –º–∞—Ä–∫–µ—Ä—É ====

              })},)})
document.getElementById('deleteButton').onclick = function () {
    deleteMode = !deleteMode;
    this.style.color = deleteMode ? 'red' : 'gray';
};



        window.addEventListener('beforeunload', (event) => {
            event.preventDefault();
            event.returnValue = '';
        });
        map.createPane('geoStaticPane');

const geoPane = map.getPane('geoStaticPane');
geoPane.style.zIndex = 450;
geoPane.style.pointerEvents = 'none';

/* –í–ê–ñ–ù–û */
geoPane.classList.add('leaflet-zoom-hide');

// –†–õ–° –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤
const rlsOptions = [
    "79–ö6",
    "35–î6–ú",
    "–ú–∞–ª–∞—Ö—ñ—Ç",
    "–ü-18–ú–ê",
    "RADA MHR",
    "SNOW",
    "–ü–ª",
    "–ü-18",
    "19–ñ6",
    "35–î6",
    "TRML-4D",
    "5–ù84–ê",
    "–ü-37"
];

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –†–õ–°
function getRlsForObject(objectId, iconUrl) {
    // –î–ª—è –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (–≤–∫–ª—é—á–∞—è —Å–ø–µ—Ü–æ–±—ä–µ–∫—Ç—ã) –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –†–õ–°
    const randomIndex = Math.floor(Math.random() * rlsOptions.length);
    return rlsOptions[randomIndex];
}

map.on('contextmenu', function (e) {
    const coords = `${e.latlng.lat}, ${e.latlng.lng}`;
    navigator.clipboard.writeText(coords).then(() => {
        alert(`–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã: ${coords}`);
    }).catch(err => {
        console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:', err);
    });
});

map.on('touchstart', function (e) {
    const touches = e.originalEvent.touches;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–∞–∂–∞—Ç–æ –î–í–ê –ø–∞–ª—å—Ü–∞
    if (touches.length === 2) {
        // –ë–µ—Ä—ë–º —Å—Ä–µ–¥–Ω—é—é —Ç–æ—á–∫—É –º–µ–∂–¥—É –ø–∞–ª—å—Ü–∞–º–∏
        const x = (touches[0].clientX + touches[1].clientX) / 2;
        const y = (touches[0].clientY + touches[1].clientY) / 2;

        const latlng = map.mouseEventToLatLng({ clientX: x, clientY: y });
        const coords = `${latlng.lat}, ${latlng.lng}`;

        navigator.clipboard.writeText(coords).then(() => {
            alert(`–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã: ${coords}`);
        }).catch(err => {
            console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:', err);
        });
    }
});
let frontLayer = null;

fetch("front.json")
  .then(response => response.json())
  .then(data => {
    frontLayer = L.geoJSON(data, {
        smoothFactor: 0,   // üî• –ö–õ–Æ–ß–ï–í–û
      style: function(feature) {
        let color = '#bdbdbd';
        let opacity = 1;
        let fillOpacity = 1;

        if (feature.properties.name === '–ë–∞–≥–∞—Ç–æ–∫—É—Ç–Ω–∏–∫ 4') {
          color = '#000000';
          opacity = 1;
          fillOpacity = 0.0;
        }

        return {
          color: color,
          weight: 1.5,
          opacity: opacity,
          fillColor: color,
          fillOpacity: fillOpacity
        };
      }
    }).addTo(map); // ‚Üê –ò–ó–ù–ê–ß–ê–õ–¨–ù–û –í–ö–õ
  })
  .catch(error => console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ JSON:", error));

  let polygons = {}; // –∞–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞–π–æ–Ω—ã
let activeDistricts = {}; // –∫–∞–∫–∏–µ —Ä–∞–π–æ–Ω—ã –≤–∫–ª—é—á–µ–Ω—ã
let menuVisible = false;
let alertsVisible = true;

fetch('districts.geojson')
  .then(response => response.json())
  .then(geojsonData => {
    const districtsByRegion = {};
    geojsonData.features.forEach(feature => {
      const region = feature.properties.ADMIN_1;
      if (!districtsByRegion[region]) districtsByRegion[region] = [];
      districtsByRegion[region].push(feature);
    });
// === –í–°–ï–ì–î–ê –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –õ–£–ì–ê–ù–°–ö–£–Æ –û–ë–õ–ê–°–¢–¨ —á–µ—Ä–µ–∑ trevoga.json ===
fetch('trevoga.json')
  .then(r => r.json())
  .then(trevogaData => {

    trevogaData.features.forEach(feature => {

      // –ò—â–µ–º "–õ—É–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å" –≤ –ª—é–±—ã—Ö —Å–≤–æ–π—Å—Ç–≤–∞—Ö
      const props = feature.properties;
      const isLugansk = Object.values(props).some(v => 
        typeof v === 'string' && v.trim().toLowerCase() === '–ª—É–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å'
      );

      if (isLugansk) {

const layer = L.geoJSON(feature, {
  style: {
    color: 'red',
    fillColor: 'red',
    fillOpacity: alertsVisible ? 0.13 : 0,
    opacity: alertsVisible ? 1 : 0,
    weight: 0.3
  }
}).addTo(map);


        const districtName =
          props.ADMIN_2 ||
          props.name ||
          props.region ||
          '–õ—É–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å';

        polygons[districtName] = layer;
        activeDistricts[districtName] = true;
      }
    });
  });


    document.querySelectorAll('#alert-menu input[type=checkbox]').forEach(checkbox => {
      const region = checkbox.id;

      checkbox.addEventListener('click', async function (e) {
        e.preventDefault(); // –±–ª–æ–∫–∏—Ä—É–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É –≥–∞–ª–æ—á–∫–∏

        // ======== –û–¢–î–ï–õ–¨–ù–û –û–ë–†–ê–ë–ê–¢–´–í–ê–ï–ú –≥.–ö–∏—ó–≤ ========
        if (region === '–≥.–ö–∏—ó–≤') {
          if (polygons['Kyiv']) {
            // –µ—Å–ª–∏ —É–∂–µ –≤–∫–ª—é—á—ë–Ω ‚Äî –≤—ã–∫–ª—é—á–∞–µ–º
            map.removeLayer(polygons['Kyiv']);
            delete polygons['Kyiv'];
            checkbox.checked = false;
            return;
          }

          // –∑–∞–≥—Ä—É–∂–∞–µ–º Kyiv.json
          const kyivData = await fetch('Kyiv.json').then(r => r.json());
const kyivLayer = L.geoJSON(kyivData, {
  style: {
    color: 'red',
    fillColor: 'red',
    fillOpacity: alertsVisible ? 0.13 : 0,
    opacity: alertsVisible ? 1 : 0,
    weight: 0.3
  }
          }).addTo(map);

          polygons['Kyiv'] = kyivLayer;
          checkbox.checked = true;
          return; // –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫
        }
        // ==============================================

        const existingList = checkbox.parentElement.querySelector('.district-list');
        if (existingList) {
          existingList.remove();
          return;
        }

        if (districtsByRegion[region]) {
          const subList = document.createElement('div');
          subList.className = 'district-list';
          subList.style.marginLeft = '20px';
          subList.style.marginTop = '5px';

          districtsByRegion[region].forEach(feature => {
            const districtName = feature.properties.ADMIN_2;

            const div = document.createElement('div');
            div.innerHTML = `
              <input type="checkbox" id="${districtName}" data-region="${region}">
              <label for="${districtName}">${districtName}</label>
            `;
            subList.appendChild(div);

            const districtCheckbox = div.querySelector('input');

            if (activeDistricts[districtName]) {
              districtCheckbox.checked = true;
            }

            districtCheckbox.onchange = function() {
              const featureData = districtsByRegion[region].find(f => f.properties.ADMIN_2 === districtName);

              if (districtCheckbox.checked) {
const layer = L.geoJSON(featureData, {
  style: {
    color: 'red',
    fillColor: 'red',
    fillOpacity: 0.13,
    weight: 0.15
  }
}).addTo(map);


                polygons[districtName] = layer;
                activeDistricts[districtName] = true;
              } else {
                if (polygons[districtName]) {
                  map.removeLayer(polygons[districtName]);
                  delete polygons[districtName];
                }
                delete activeDistricts[districtName];
              }
            };
          });

          checkbox.parentElement.appendChild(subList);
        }
      });
    });
  });

// –∫–Ω–æ–ø–∫–∞ "–î–∞—Ç—å —Ç—Ä–µ–≤–æ–≥—É"
document.getElementById('alert-button').onclick = function() {
  menuVisible = !menuVisible;
  document.getElementById('alert-menu').style.display = menuVisible ? 'block' : 'none';
};
        function getKievTime() {
    const options = {
        timeZone: 'Europe/Kiev',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false // 24-—á–∞—Å–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç
    };
    return new Intl.DateTimeFormat('ru-RU', options).format(new Date());
}

let objectIdCounter = 44000;

function getNextObjectId() {
    return objectIdCounter++;


    const iconHTML = `
        <div class="icon-container ${iconClass}">
            <img src="${iconUrl}" class="icon" />
            <div class="info-container ${shiftedClass}">
                <span class="label-container ${iconClass}">${objectId} ${minskTime}</span>
                <span class="r-container ${iconClass}">–ï–ü–í–û</span>
            </div>
        </div>
    `;
    return iconHTML;
}
let objectIdCounterBlue = '0250';

function getNextObjectIdBlue() {
  return objectIdCounterBlue++;
}
let counterLitakId = 9900;
function getNextLitakId() {
    return counterLitakId++;
}
    function updateAlertCount() {
      const bodyText = document.body.innerText || document.body.textContent;
      const matches = bodyText.match(/(–ü–ü|–°–í|–õ–ë|–ó–õ)/gi);
      const count = matches ? matches.length : 0;
      document.getElementById('alert-button').textContent = count;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 500 –º—Å
    setInterval(updateAlertCount, 500);
    updateAlertCount();

    const zoomButtons = document.getElementById('zoom-buttons');
    let hideTimeout;

    function showZoomButtons() {
      zoomButtons.classList.add('show');
      if (hideTimeout) clearTimeout(hideTimeout);
      hideTimeout = setTimeout(() => {
        zoomButtons.classList.remove('show');
      }, 3000);
    }

    map.on('movestart', showZoomButtons);
    map.on('move', showZoomButtons);

    document.getElementById('zoom-in').onclick = () => map.zoomIn();
    document.getElementById('zoom-out').onclick = () => map.zoomOut();
    const zoomInBtn = document.getElementById('zoom-in');
const zoomOutBtn = document.getElementById('zoom-out');

function updateZoomButtons() {
  const zoom = map.getZoom();
  const minZoom = map.getMinZoom();
  const maxZoom = map.getMaxZoom();

  zoomOutBtn.disabled = zoom <= minZoom;
  zoomInBtn.disabled  = zoom >= maxZoom;
}

// –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑—É–º–∞
map.on('zoomend', updateZoomButtons);

// —Å—Ä–∞–∑—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
updateZoomButtons();

// –∫–ª–∏–∫–∏
zoomInBtn.onclick = () => map.zoomIn();
zoomOutBtn.onclick = () => map.zoomOut();

    const ICON_SIZES_BY_STYLE = {
  'style-val-slom':   [32, 32],
    'style-val':   [32, 32],
  'style-mariupol':   [24.1, 24.1],
  'style-bandera':    [28.8, 28.8],
  'style-vladimir':   [29, 29],
  'style-pomelo':     [27, 27],
  'style-labrador':  [26, 26],
  'style-pol':       [30, 30],
'style-labrador-vl':  [30, 30]
};

          const img = document.getElementById('toggleLayersImg');
  const layers = document.querySelector('.leaflet-control-layers');

  img.addEventListener('click', () => {
    layers.classList.toggle('active');
  });
const menu = document.getElementById('rightMenu');
let mouseStartX = 0;
let mouseStartY = 0;
let isMouseSwiping = false;

document.addEventListener('mousedown', e => {
  // —Ç–æ–ª—å–∫–æ –õ–ö–ú
  if (e.button !== 0) return;

  mouseStartX = e.clientX;
  mouseStartY = e.clientY;

  // –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—Ç–∞—Ä—Ç —É –ø—Ä–∞–≤–æ–≥–æ –∫—Ä–∞—è
  if (mouseStartX > window.innerWidth - 25) {
    isMouseSwiping = true;
  }
});

document.addEventListener('mouseup', e => {
  if (!isMouseSwiping) return;

  const dx = mouseStartX - e.clientX;
  const dy = Math.abs(mouseStartY - e.clientY);

  // —Å–≤–∞–π–ø –≤–ª–µ–≤–æ
  if (dx > 80 && dy < 60) {
    menu.classList.add('open');
  }

  isMouseSwiping = false;
});
let menuMouseStartX = 0;

menu.addEventListener('mousedown', e => {
  if (e.button !== 0) return;
  menuMouseStartX = e.clientX;
});

menu.addEventListener('mouseup', e => {
  const dx = e.clientX - menuMouseStartX;

  // —Å–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ
  if (dx > 80) {
    menu.classList.remove('open');
  }
});

const toggle = document.getElementById('toggleFront');

toggle.addEventListener('change', () => {
  if (!frontLayer) return;

  if (toggle.checked) {
    map.addLayer(frontLayer);
  } else {
    map.removeLayer(frontLayer);
  }
});
const toggleAlerts = document.getElementById('toggleAlerts');

toggleAlerts.addEventListener('change', () => {
  alertsVisible = toggleAlerts.checked;

  Object.values(polygons).forEach(layer => {
    layer.setStyle({
      fillOpacity: alertsVisible ? 0.13 : 0,
      opacity: alertsVisible ? 1 : 0
    });
  });
});

document.addEventListener('DOMContentLoaded', () => {
  const styleSelect = document.getElementById('styleSelect');
  const root = document.getElementById('map');

  if (!styleSelect || !root) return;

  // –Ω–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å
  root.classList.add('style-pomelo');

  styleSelect.addEventListener('change', () => {
    root.classList.remove('style-pomelo', 'style-mariupol', 'style-bandera', 'style-vladimir', 'style-val-slom', 'style-val', 'style-labrador', 'style-labrador-vl', 'style-pol');
const styleClass = `style-${styleSelect.value}`;
root.classList.add(styleClass);

// üî• –ü–ï–†–ï–°–ß–Å–¢ –†–ê–ó–ú–ï–†–û–í –ò–ö–û–ù–û–ö
updateAllMarkersForStyle(styleClass);

if (styleSelect.value === 'bandera') {
  root.classList.add('style-bandera');
} else if (styleSelect.value === 'mariupol') {
  root.classList.add('style-mariupol');
} else if (styleSelect.value === 'vladimir') {
  root.classList.add('style-vladimir');
} else if (styleSelect.value === 'val-slom') {
  root.classList.add('style-val-slom');
} else if (styleSelect.value === 'val') {
  root.classList.add('style-val');
} else if (styleSelect.value === 'labrador') {
  root.classList.add('style-labrador');
  } else if (styleSelect.value === 'labrador-vl') {
  root.classList.add('style-labrador-vl');
} else if (styleSelect.value === 'pol') {
  root.classList.add('style-pol');
} else {
  root.classList.add('style-pomelo');
}
  });
});

fetch('line.json')
  .then(res => res.json())
  .then(data => {
    frontLineLayer = L.geoJSON(data, {
      style: {
        color: 'red',
        weight: 1.5,
        opacity: 0
      }
    }).addTo(map);
  });


fetch('okkyp.json')
  .then(res => res.json())
  .then(data => {
    occLayer = L.geoJSON(data, {

      style: {
        stroke: false,
        fillColor: '#e6a57a',
        fillOpacity: 0
      }
    }).addTo(map);
  });

  const toggleFrontLine = document.getElementById('toggleFrontLine');

if (toggleFrontLine) {
  toggleFrontLine.addEventListener('change', () => {
    const visible = toggleFrontLine.checked;

    if (frontLineLayer) {
      frontLineLayer.setStyle({
        opacity: visible ? 1 : 0
      });
    }

    if (occLayer) {
      occLayer.setStyle({
        fillOpacity: visible ? 0.3 : 0
      });
    }
  });
}
const toggleText = document.getElementById('toggleText');
const mapRoot = document.getElementById('map');

if (toggleText && mapRoot) {
  // –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–≤–∫–ª—é—á–µ–Ω–æ)
  if (!toggleText.checked) {
    mapRoot.classList.add('hide-text');
  }

  toggleText.addEventListener('change', () => {
    mapRoot.classList.toggle('hide-text', !toggleText.checked);
  });
}
const toggleQuality = document.getElementById('toggleQuality');

if (toggleQuality && mapRoot) {
  toggleQuality.addEventListener('change', () => {
    mapRoot.classList.toggle(
      'show-quality',
      toggleQuality.checked
    );
  });
}

document.addEventListener('DOMContentLoaded', () => {
  const styleSelect = document.getElementById('styleSelect');
  const root = document.getElementById('map');
  const toggleQuality = document.getElementById('toggleQuality');

  if (!styleSelect || !root) return;

  // –Ω–∞—á–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å
  root.classList.add('style-pomelo');
styleSelect.addEventListener('change', () => {
  const value = styleSelect.value;

  // —Å–Ω–∏–º–∞–µ–º –≤—Å–µ —Å—Ç–∏–ª–∏
  root.classList.remove(
    'style-pomelo',
    'style-mariupol',
    'style-bandera',
    'style-vladimir',
    'style-val-slom',
      'style-val',
    'style-labrador',
    'style-labrador-vl'
  );

  const styleClass = `style-${value}`;
  root.classList.add(styleClass);

  // –ø–µ—Ä–µ—Å—á—ë—Ç —Ä–∞–∑–º–µ—Ä–æ–≤ –∏–∫–æ–Ω–æ–∫
  updateAllMarkersForStyle(styleClass);

  // ===== –ê–í–¢–û-–ü–†–ê–í–ò–õ–ê –°–¢–ò–õ–ï–ô =====

  // 1Ô∏è‚É£ val-slom ‚Üí –∫–∞—á–µ—Å—Ç–≤–æ –í–ö–õ
  if (value === 'val-slom' && toggleQuality) {
    toggleQuality.checked = true;
    root.classList.add('show-quality');
  }
    if (value === 'val' && toggleQuality) {
    toggleQuality.checked = true;
    root.classList.add('show-quality');
  }

  // 2Ô∏è‚É£ labrador ‚Üí —Ç–µ–∫—Å—Ç –í–´–ö–õ
  if (value === 'labrador' && toggleText) {
    toggleText.checked = false;
    root.classList.add('hide-text');
  }

  // 3Ô∏è‚É£ labrador-vl ‚Üí —Ç–µ–∫—Å—Ç –í–´–ö–õ + –∫–∞—á–µ—Å—Ç–≤–æ –í–ö–õ
  if (value === 'labrador-vl') {
    if (toggleText) {
      toggleText.checked = false;
      root.classList.add('hide-text');
    }
    if (toggleQuality) {
      toggleQuality.checked = true;
      root.classList.add('show-quality');
    }
  }
});
});
document.addEventListener('DOMContentLoaded', () => {
  const toggleRadius = document.getElementById('toggleRadius');
  if (!toggleRadius || !window.map) return;

  const KYIV = [50.4501, 30.5234];
  const RADIUS_METERS = 3_000_000;

  const kyivRadiusCircle = L.circle(KYIV, {
    radius: RADIUS_METERS,
    color: '#4da6ff',
    weight: 1.5,
    fillColor: '#4da6ff',
    fillOpacity: 0.12,
    opacity: 0.8
  });

  toggleRadius.addEventListener('change', () => {
    if (toggleRadius.checked) {
      kyivRadiusCircle.addTo(map);
    } else {
      map.removeLayer(kyivRadiusCircle);
    }
  });
});

document.addEventListener('DOMContentLoaded', () => {

  /* ===============================
     –ü–û–ó–ò–¶–ò–Ø (Chel.png)
  =============================== */

  const togglePosition = document.getElementById('togglePosition');
  if (!togglePosition) {
    console.warn('togglePosition not found');
    return;
  }

  let positionMarker = null;

  // —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
  let currentLatLng = [50.433714918437474, 30.623164051610438];

  function createPositionMarker() {
    const icon = L.icon({
      iconUrl: 'Chel.png',
      iconSize: [32, 32],
      iconAnchor: [16, 28],
      popupAnchor: [0, -32]
    });

    positionMarker = L.marker(currentLatLng, { icon });

    positionMarker.bindPopup(`
      <div style="
        min-width:260px;
        font-size:14px;
      ">
        <div style="font-weight:600; margin-bottom:8px;">
          –ù–æ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è
        </div>

        <input
          id="coord-input"
          type="text"
          value="${currentLatLng[0]}, ${currentLatLng[1]}"
          placeholder="Lat, Lng"
          style="
            width:100%;
            padding:6px 8px;
            font-size:14px;
            box-sizing:border-box;
            margin-bottom:8px;
          "
        />

        <button
          id="coord-apply"
          style="
            width:100%;
            padding:6px;
            font-size:14px;
            cursor:pointer;
          "
        >
          –ü–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏
        </button>
      </div>
    `);

    positionMarker.on('popupopen', () => {
      setTimeout(() => {
        const btn = document.getElementById('coord-apply');
        const input = document.getElementById('coord-input');
        if (!btn || !input) return;

        btn.onclick = () => {
          const parts = input.value.split(',').map(v => v.trim());
          if (parts.length !== 2) return;

          const lat = parseFloat(parts[0]);
          const lng = parseFloat(parts[1]);
          if (isNaN(lat) || isNaN(lng)) return;

          currentLatLng = [lat, lng];

          positionMarker.setLatLng(currentLatLng);
          map.panTo(currentLatLng);
          positionMarker.closePopup();
        };
      }, 0);
    });

    positionMarker.addTo(map);
  }

  togglePosition.addEventListener('change', () => {
    if (typeof map === 'undefined') {
      console.error('map is undefined');
      return;
    }

    if (togglePosition.checked) {
      if (!positionMarker) {
        createPositionMarker();
      } else {
        positionMarker.addTo(map);
      }
    } else {
      if (positionMarker) {
        map.removeLayer(positionMarker);
      }
    }
  });

});
function updateMarkerIconSize(marker, styleClass) {
  const size = ICON_SIZES_BY_STYLE[styleClass];
  if (!size) return;

  const [w, h] = size;

  const icon = marker.getIcon();
  if (!icon || !icon.options) return;

  icon.options.iconSize = [w, h];
  icon.options.iconAnchor = [w / 2, h / 2];

  marker.setIcon(icon);
}
function updateAllMarkersForStyle(styleClass) {
  markers.forEach(marker => {
    updateMarkerIconSize(marker, styleClass);
  });
}
const mapSelect = document.getElementById('mapSelect');

if (mapSelect) {
  mapSelect.addEventListener('change', () => {
    const selected = mapSelect.value;
    const nextLayer = MAP_LAYERS[selected];

    if (!nextLayer || nextLayer === currentBaseLayer) return;

    // —É–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—ã–π —Å–ª–æ–π
    map.removeLayer(currentBaseLayer);

    // –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π
    nextLayer.addTo(map);

    currentBaseLayer = nextLayer;
  });
}
const HIGH_SPEED_THRESHOLD = 2000;

const HIGH_SPEED_LINE_STYLE = {
  color: 'red',
  weight: 1.5,
  opacity: 0.9,
  dashArray: '6 6',   // üî• –ø—É–Ω–∫—Ç–∏—Ä
  lineCap: 'round'
};
const ScaleBracketTop = L.Control.extend({
  options: {
    maxWidth: 160
  },

  onAdd(map) {
    this._map = map;

    this._container = L.DomUtil.create('div', 'leaflet-scale-bracket');
    this._label = L.DomUtil.create('span', '', this._container);
    this._right = L.DomUtil.create('div', 'right', this._container);

    map.on('zoomend moveend', this._update, this);
    this._update();

    return this._container;
  },

  _update() {
    const map = this._map;
    const width = this.options.maxWidth;

    const centerY = map.getSize().y / 2;
    const centerX = map.getSize().x / 2;

    const p1 = map.containerPointToLatLng([centerX - width / 2, centerY]);
    const p2 = map.containerPointToLatLng([centerX + width / 2, centerY]);

    const meters = map.distance(p1, p2);

    let text;
    if (meters >= 1000) {
      text = `${Math.round(meters / 1000)} km`;
    } else {
      text = `${Math.round(meters)} m`;
    }

    this._container.style.width = width + 'px';
    this._label.textContent = text;
  }
});
const scaleTop = new ScaleBracketTop({ maxWidth: 160 });
map.addControl(scaleTop);

const userMarkers = new Set();
const originalSrc = new WeakMap();

const EXCLUDE = ['zl', 'blue-id', 'perexop', 'vertolet'];

let CURRENT_PHASE = 'NORMAL';
// NORMAL | HIDDEN | NEYST
function getMarkers() {
  const markers = [];
  map.eachLayer(layer => {
    if (layer instanceof L.Marker) {
      markers.push(layer);
    }
  });
  return markers;
}
function hideMarkers() {
  getMarkers().forEach(m => {
    const el = m.getElement();
    if (el) el.style.display = 'none';
  });
}
function setMarkerImage(marker, src) {
  const el = marker.getElement();
  if (!el) return;

  const img = el.querySelector('img.icon');
  if (img) {
    img.src = src;
  }
}
function restoreMarkerImage(marker) {
  if (marker._originalImgSrc) {
    setMarkerImage(marker, marker._originalImgSrc);
  }
}
function applyNeyst(marker) {
  setMarkerImage(marker, 'neyst tip.png');
}


function showNeyst() {
  getMarkers().forEach(m => {
    const el = m.getElement();
    if (!el) return;

    const img = el.querySelector('img.icon');
    if (!img) return;

    el.style.display = '';

    // —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª –û–î–ò–ù –†–ê–ó
    if (!img.dataset.originalSrc) {
      img.dataset.originalSrc = img.src;
    }

    const container = el.querySelector('.icon-container');
    const excluded =
      container && EXCLUDE.some(c => container.classList.contains(c));

    if (!excluded) {
      img.src = 'neyst tip.png';
    }
  });
}
function restoreIcons() {
  getMarkers().forEach(m => {
    const el = m.getElement();
    if (!el) return;

    const img = el.querySelector('img.icon');
    if (!img) return;

    if (img.dataset.originalSrc) {
      img.src = img.dataset.originalSrc;
    }
  });
}function getRandomInterval() {
  const BASE = 2 * 60 * 60 * 1000;      // 2 —á–∞—Å–∞
  const DELTA = 30 * 60 * 1000;         // ¬±30 –º–∏–Ω—É—Ç

  return BASE + (Math.random() * 2 - 1) * DELTA;
}
function startNeystCycle() {
  const delay = getRandomInterval();

  console.log(
    '–°–ª–µ–¥—É—é—â–∏–π —Ü–∏–∫–ª —á–µ—Ä–µ–∑',
    Math.round(delay / 60000),
    '–º–∏–Ω'
  );

  setTimeout(() => {
    // üëâ –¢–£–¢ –¢–í–û–Ø –õ–û–ì–ò–ö–ê
    // hide ‚Üí neyst ‚Üí return

    runNeystOnce(); // –Ω–∞–ø—Ä–∏–º–µ—Ä

    // –ø–ª–∞–Ω–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π
    startNeystCycle();

  }, delay);
}
function runNeystOnce() {
  // —Å–∫—Ä—ã–ª–∏
  hideMarkers();

  setTimeout(showNeyst, 30000);       // 30 —Å–µ–∫ –ø—É—Å—Ç–æ
  setTimeout(restoreIcons, 90000);    // 60 —Å–µ–∫ neyst
}
startNeystCycle();

  const fullscreenBtn = document.getElementById('fullscreenBtn');

  fullscreenBtn.addEventListener('click', () => {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen().catch(err => {
        console.error(`–û—à–∏–±–∫–∞ fullscreen: ${err.message}`);
      });
    } else {
      document.exitFullscreen();
    }
  });
document.body.classList.remove(oldStyle);
void document.body.offsetHeight; // üí• –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π reflow
document.body.classList.add(newStyle);
function detectRealTheme() {
  const darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
  const isDarkSystem = darkQuery.matches;

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Android WebView / Fully
  const isAndroidWebView = /Android/.test(navigator.userAgent) && /wv|Version\/\d+\.\d+/.test(navigator.userAgent);

  // –ï—Å–ª–∏ —ç—Ç–æ WebView, –ª—É—á—à–µ –¥–∞—Ç—å —Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–ª–∏ —Ç—ë–º–Ω—É—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  if (isAndroidWebView) {
    return 'dark'; // üëà –º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞ 'light' –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
  }

  return isDarkSystem ? 'dark' : 'light';
}

function applyMenuTheme(theme) {
  const root = document.documentElement;
  root.style.setProperty('--menu-bg', theme === 'dark' ? '#5B595C' : '#D6D8D7');
}

// –ü–µ—Ä–≤–∏—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
applyMenuTheme(detectRealTheme());

// –°–ª—É—à–∞–µ–º —Å–º–µ–Ω—É —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ–º—ã (–¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤)
window.matchMedia('(prefers-color-scheme: dark)')
  .addEventListener('change', e => {
    applyMenuTheme(e.matches ? 'dark' : 'light');
  });


</script>
<script>
(function () {
  const firstText = "–û—á—ñ–∫—É—î—Ç—å—Å—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó —Ç–∞ –∑–æ–Ω–∏ –≤–∏–¥–∞—á—ñ. –Ø–∫—â–æ —Ü—ñ–ª—ñ –Ω–µ –∑'—è–≤–ª—è—Ç—å—Å—è –ø—Ä–æ—Ç—è–≥–æ–º 5 —Ö–≤ ‚Äî –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—É, —è–∫–∏–π –≤–∏–¥–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.";
  const secondText = "–ù–µ –±—É–ª–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—Ä–æ—Ç—è–≥–æ–º —Ç—Ä–∏–≤–∞–ª–æ–≥–æ —á–∞—Å—É";

  function getEl() {
    return document.getElementById('warning-message');
  }

  // 1Ô∏è‚É£ –°—Ä–∞–∑—É —Å—Ç–∞–≤–∏–º –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  function setInitialText() {
    const el = getEl();
    if (el) el.textContent = firstText;
  }

  // 2Ô∏è‚É£ –ß–µ—Ä–µ–∑ 10 —Å–µ–∫ –º–µ–Ω—è–µ–º –Ω–∞ –≤—Ç–æ—Ä–æ–µ
  function switchToSecond() {
    const el = getEl();
    if (el) el.textContent = secondText;
  }

  // 3Ô∏è‚É£ –°—Ç–∞—Ä–∞—è "–º–æ–Ω–µ—Ç–∫–∞" ‚Äî —Å–ª—É—á–∞–π–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–ª–∏ —Å–∫—Ä—ã–≤–∞—Ç—å
  function randomVisibility() {
    const el = getEl();
    if (!el) return;

    const show = Math.random() < 0.5;
    el.style.display = show ? 'block' : 'none';
  }

  // –ó–∞–ø—É—Å–∫ –ª–æ–≥–∏–∫–∏
  setInitialText();
  setTimeout(switchToSecond, 10000);

  // –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç –ø–æ–¥–±—Ä–∞—Å—ã–≤–∞–µ–º –º–æ–Ω–µ—Ç–∫—É
  setInterval(randomVisibility, 10 * 60 * 1000);
})();

L.svg().addTo(map);
d3.select(map.getPanes().overlayPane)
  .style("will-change", "auto")
  .style("transform-origin", "0 0")
  .style("transition", "none");

var svg = d3.select(map.getPanes().overlayPane).select("svg");


var points = [
  [50.64316420146997, 36.586700103803125, "–ë–ï–õ–ì–û–†–û–î"],
  [51.329543925933216, 37.76978798190241, "–°–¢–ê–†–ò–ô –û–°–ö–û–õ"],
  [51.751072953680115, 36.29457216451094, "–ö–£–†–°–¨–ö"],
  [52.93462838794772, 36.001841461022906, "–û–†–¨–û–õ"],
  [52.340370023817584, 32.16888243715642, "–ö–õ–Ü–ú–û–í–û"],
  [52.52699184845294, 31.016634578964695, "–ì–û–ú–ï–õ–¨"],
  [51.98324651987717, 29.163202794775504, "–ú–û–ó–ò–†"],
  [53.10154504001477, 29.20320293724112, "–ë–û–ë–†–£–ô–°–¨–ö"],
  [53.51913843016285, 30.195491637589853, "–ë–ò–•–û–í"],
  [53.95568203382907, 30.09391259089332, "–ú–û–ì–ò–õ–¨–û–í"],
  [52.27566842672289, 26.77462517782038, "–õ–£–ù–Ü–ù–ï–¶–¨"],
  [52.55760561721687, 24.87967847110502, "–û–°–û–í–¶–ò"],
  [52.10830992226236, 23.896208994647264, "–ë–†–ï–°–¢"],
  [53.09493187242125, 26.046711825490686, "–ë–ê–†–ê–ù–û–í–ò–ß–Ü"],
  [53.77348918429723, 27.577396860465303, "–ú–ê–ß–£–õ–ò–©–Ü"],
  [53.87678696307106, 25.377966927225234, "–õ–Ü–î–ê"],
  [51.61862861239078, 39.14122077532461, "–í–û–†–û–ù–ï–ñ"],
  [51.65299485794643, 39.25630360880956, "–ü–†–ò–î–ê–ß–ê"],
  [50.791702820103566, 40.60787098737986, "–ë–£–¢–£–†–õ–Ü–ù–û–í–ö–ê"],
  [51.36738851293407, 42.18211641197179, "–ë–û–†–ò–°–û–ì–õ–ï–ë–°–¨–ö"],
  [52.64923000018133, 39.43368330173067, "–õ–Ü–ü–ï–¶–¨–ö"],
  [48.95530185877511, 40.296950411395905, "–ú–Ü–õ–õ–ï–†–û–í–ï"],
  [51.53176710654709, 43.301667038529395, "–ë–ê–õ–ê–®–ï–í"],
  [53.71530429502497, 33.339128386006415, "–°–ï–©–ê"],
  [54.22656209801073, 34.36909611585733, "–®–ê–ô–ö–û–í–ö–ê"],
  [54.34107701761924, 32.47163746643338, "–®–ê–¢–ê–õ–û–í–û"],
  [55.14893594274698, 34.3830205102369, "–í–Ø–ó–¨–ú–ê"],
  [54.239126208139304, 37.60063769062368, "–¢–£–õ–ê"],
  [55.22843155351626, 36.60875668775432, "–Ñ–†–ú–û–õ–Ü–ù–û"],
  [56.36524534419243, 36.73518513592129, "–ö–õ–Ü–ù"],  
  [56.82473390321671, 35.75724712587261, "–¢–í–Ñ–†–¨"],  
  [55.97253911053447, 37.41520615411865, "–®–ï–†–ï–ú–ï–¢–¨–Ñ–í–û"],  
  [55.59157958863817, 37.261483481532196, "–í–ù–£–ö–û–í–û"],
  [55.87832452206118, 38.05951529725053, "–ß–ö–ê–õ–û–í–°–¨–ö–ò–ô"], 
  [55.40858393748578, 37.90814925388992, "–î–û–ú–û–î–Ñ–î–û–í–û"], 
  [48.63613233586011, 43.78961510289652, "–ú–ê–†–ò–ù–û–í–ö–ê"], 
  [48.311975427039336, 41.790039211953406, "–ú–û–†–û–ó–û–í–°–¨–ö"], 
  [47.6346629310425, 43.09541632400751, "–ö–û–¢–Ñ–õ–¨–ù–Ü–ö–û–í–û"], 
  [47.49390222814425, 39.92474481497282, "–ü–õ–ê–¢–û–í"],
  [47.25925996290294, 39.8193017556059, "–†–û–°–¢–û–í-–ù–ê-–î–û–ù–£"],
  [47.27748250604513, 39.63588157642341, "–†–û–°–¢–û–í-–ù–ê-–î–û–ù–£ –¶–ï–ù–¢–†–ê–õ–¨–ù–ò–ô"],
  [47.11620533363362, 39.79797350729799, "–ë–ê–¢–ê–ô–°–¨–ö"],
  [46.83610297641517, 40.38024873998385, "–ó–ï–†–ù–û–ì–†–ê–î"],
  [47.24638325781048, 38.84001768062582, "–¢–ê–ì–ê–ù–†–û–ì"],
  [46.53915628003489, 39.547519748687066, "–ö–£–©–ï–í–ö–ê"],
  [46.679945316867276, 38.22030288544164, "–ï–ô–°–¨–ö"],
  [46.05974788242411, 38.23971649718546, "–ü–†–ò–ú–û–†–°–¨–ö-–ê–•–¢–ê–†–°–¨–ö"],
  [45.00265496905655, 37.34792387499154, "–ê–ù–ê–ü–ê"],
  [45.44391601411748, 39.420442203287564, "–ö–û–†–ï–ù–û–í–°–¨–ö"],
  [45.03444160321688, 39.18812995316336, "–ö–†–ê–°–ù–û–î–ê–†"],
  [45.08415941343412, 38.944928349721636, "–ö–†–ê–°–ù–û–î–ê–† –¶–ï–ù–¢–†–ê–õ–¨–ù–ò–ô"],
  [44.582804542357316, 38.01338102187856, "–ì–ï–õ–ï–ù–î–ñ–ò–ö"],
  [44.9627830494523, 37.999008465306126, "–ö–†–ò–ú–°–¨–ö"],
  [44.679450525867345, 40.03589534336019, "–ú–ê–ô–ö–û–ü"],
  [44.9686069158003, 41.10805600878626, "–ê–†–ú–ê–í–Ü–†"],
  [47.42263956135605, 47.926634203055265, "–ê–®–£–õ–£–ö"],
  [48.30903393578841, 46.20404893781147, "–ê–•–¢–£–ë–Ü–ù–°–¨–ö"],
  [46.28286917512861, 48.01063705556252, "–ê–°–¢–†–ê–•–ê–ù–¨"],
  [46.39570876953713, 47.88679378356488, "–ê–°–¢–†–ê–•–ê–ù–¨ –ü–†–Ü–í–û–õ–ñ–°–¨–ö–ò–ô"],
  [43.78997884117482, 44.59921587106189, "–ú–û–ó–î–û–ö"],
  [43.38823090620519, 45.699867265518876, "–ì–†–û–ó–ù–ò–ô"],
  [43.29801208044466, 45.78411723024534, "–•–ê–ù–ö–ê–õ–ê"],
  [45.69959465827638, 34.42053791755158, "–î–ñ–ê–ù–ö–û–ô"],
  [45.57952024507596, 34.28204552266893, "–í–Ü–õ–¨–ù–ï"],
  [45.323056117604196, 34.106010388523856, "–ë–Ü–Æ–ö-–û–ù–õ–ê–† (–û–ö–¢–Ø–ë–†–°–¨–ö–ï)"],
  [45.116033128850866, 33.97636352139827, "–ì–í–ê–†–î–Ü–ô–°–¨–ö–ï"],
  [45.05246996885969, 33.97385854392302, "–°–Ü–ú–§–ï–†–û–ü–û–õ–¨"],
  [45.09172516614983, 33.60466835154104, "–°–ê–ö–ò"],
  [45.22583478289445, 33.37633415910674, "–Ñ–í–ü–ê–¢–û–†–Ü–Ø"],
  [44.780559881978256, 33.573029043704366, "–ö–ê–ß–ê"],
  [44.69145554690335, 33.57551997316974, "–°–ï–í–ê–°–¢–û–ü–û–õ–¨-–ë–ê–õ–¨–ë–ï–ö"],
  [44.57944354757693, 33.395811158778464, "–•–ï–†–°–û–ù–ï–°"],
  [45.16542521560147, 35.18191549054776, "–Ü–°–õ–Ø–ú-–¢–ï–†–ï–ö (–ö–Ü–†–û–í–°–¨–ö–ï)"],
  [45.37325910850011, 36.40393317532401, "–ö–ï–†–ß"],
];
/* ================= STORAGE ================= */

var airfieldItems = [];

/* ================= FUNCTION ================= */

function addCity(lat, lng, name) {
  var g = svg.append("g");

  function update() {
    var p = map.latLngToLayerPoint([lat, lng]);
    g.attr("transform", `translate(${p.x},${p.y})`);
  }

  // –∫—Ä–µ—Å—Ç–∏–∫
  g.append("line")
    .attr("x1", -4).attr("y1", -4)
    .attr("x2", 4).attr("y2", 4)
    .attr("stroke", "red")
    .attr("stroke-width", 1);

  g.append("line")
    .attr("x1", -4).attr("y1", 4)
    .attr("x2", 4).attr("y2", -4)
    .attr("stroke", "red")
    .attr("stroke-width", 1);

  // —Ç–µ–∫—Å—Ç
  g.append("text")
    .attr("x", 7)
    .attr("y", -3)
    .attr("fill", "red")
    .attr("font-size", "7px")
    .text(name);

map.on("moveend zoomend viewreset", update);

  update();

  airfieldItems.push({ g, update });
}

/* ================= ADD ALL ================= */

points.forEach(p => addCity(p[0], p[1], p[2]));

/* ================= TOGGLE ================= */

document.getElementById("toggleAirfields").addEventListener("change", function () {
  airfieldItems.forEach(item => {
    item.g.style("display", this.checked ? "block" : "none");
  });
});
  function updateFullscreenIcon() {
    const img = document.querySelector('#fullscreenBtn img');
    if (!img) return;

    const isLight = window.matchMedia('(prefers-color-scheme: light)').matches;
    img.src = isLight ? 'ugol2.png' : 'ugol.png';
  }

  // –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  updateFullscreenIcon();

  // –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ–º—ã –Ω–∞ –ª–µ—Ç—É
  window.matchMedia('(prefers-color-scheme: light)')
    .addEventListener('change', updateFullscreenIcon);
document.addEventListener("DOMContentLoaded", () => {
  const togglePosition = document.getElementById("togglePosition");
  const leftArrowButton = document.getElementById("left-arrow-button");

  if (!togglePosition || !leftArrowButton) return;

  function updateButton() {
    leftArrowButton.style.display = togglePosition.checked
      ? "flex"
      : "none";
  }

  // –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  updateButton();

  // —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ —Ç—É–º–±–ª–µ—Ä
  togglePosition.addEventListener("change", updateButton);
});
const BASE_ZOOM = map.getZoom();

map.on('zoom', () => {
  const zoom = map.getZoom();

  let scale = 1;

  if (zoom < BASE_ZOOM) {
    // —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–¥–∞–ª–µ–Ω–∏–∏
    scale = Math.max(0.85, 1 - (BASE_ZOOM - zoom) * 0.05);
  }

  document.querySelectorAll('.icon-container').forEach(el => {
    el.style.transform = `scale(${scale})`;
  });
});
function updateAlertButton() {
  const btn = document.getElementById('alert-button');
  if (!btn) return;

  if (markersCount >= 1) {
    btn.style.backgroundColor = '#50785D'; // –∫–∞–∫ —Å–µ–π—á–∞—Å
  } else {
    btn.style.backgroundColor = '#D90045'; // —Å—Ç–∞—Ä—Ç–æ–≤—ã–π
  }
}

const checkbox = document.getElementById("forceTargetColors");
const body = document.body;

/* —Å—Ç–∏–ª–∏, –≥–¥–µ —Ü–≤–µ—Ç –í–ö–õ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
const COLOR_STYLES = [
  "style-mariupol",
  "style-val",
  "style-val-slom",
  "style-labrador"
];

function updateFormularColor() {
  body.classList.toggle("formular-color", checkbox.checked);
}

/* –í–ê–ñ–ù–û: –í–´–ó–´–í–ê–¢–¨ –¢–û–õ–¨–ö–û –≠–¢–£ –§–£–ù–ö–¶–ò–Æ –î–õ–Ø –°–¢–ò–õ–ï–ô */
function setStyle(styleClass) {
  body.className = body.className
    .split(" ")
    .filter(c => !c.startsWith("style-"))
    .join(" ");

  body.classList.add(styleClass);

  const autoOn = COLOR_STYLES.includes(styleClass);
  checkbox.checked = autoOn;
  updateFormularColor();
}

/* —Ä—É—á–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ */
checkbox.addEventListener("change", updateFormularColor);

/* —Å—Ç–∞—Ä—Ç */
updateFormularColor();
map.createPane('azimuthLegendPane');
map.getPane('azimuthLegendPane').style.zIndex = 650;


  const plusBtn = document.getElementById("plusBtn");
  const plusPopup = document.getElementById("plusPopup");

  plusBtn.addEventListener("click", () => {
    plusPopup.classList.toggle("open");
  });

  // –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –º–∏–º–æ
  document.addEventListener("click", (e) => {
    if (!plusPopup.contains(e.target) && !plusBtn.contains(e.target)) {
      plusPopup.classList.remove("open");
    }
  });
  const azOpen = document.getElementById('azimuthOpen');
const azOverlay = document.getElementById('azimuthOverlay');

azOpen.onclick = () => azOverlay.style.display = 'block';
azOverlay.onclick = e => {
  if (e.target === azOverlay) azOverlay.style.display = 'none';
};
const firstModal = document.getElementById('azimuthOverlay');
const secondModal = document.getElementById('azimuthSettingsOverlay');

document.querySelectorAll('.azimuth-link').forEach(el => {
  if (el.textContent.trim() === '–í–∏–±—Ä–∞—Ç–∏ –Ω–∞ –º–∞–ø—ñ') {
    el.addEventListener('click', () => {
      firstModal.style.display = 'none';
      secondModal.style.display = 'block';
    });
  }
});/* =========================
   GLOBAL STATE
========================= */

let azimuthLayer = null;
let azimuthPickMode = false;

const azimuthConfig = {
  radius: 200,
  step: 10,
  legend: true
};

const azimuthSvgLabels = [];
const azimuthDistanceLabels = [];

/* =========================
   SVG HELPERS
========================= */

function updateAzimuthSvgLabelPosition(latlng, el) {
  const p = map.latLngToLayerPoint(latlng);
  el.setAttribute('x', p.x);
  el.setAttribute('y', p.y);
}


function drawAzimuthLabelSVG(latlng, text) {
  const svg = map.getRenderer(map)._container;

  const textEl = document.createElementNS('http://www.w3.org/2000/svg', 'text');
  textEl.textContent = text;
  textEl.classList.add('azimuth-angle-svg');

  textEl.setAttribute('text-anchor', 'middle');
  textEl.setAttribute('dominant-baseline', 'middle');

  textEl.style.fill = '#2f47ff';
  textEl.style.fontSize = '11px';
  textEl.style.fontFamily = 'Roboto, Arial, sans-serif';
  textEl.style.fontWeight = '400';
  textEl.style.pointerEvents = 'none';

  svg.appendChild(textEl);

  azimuthSvgLabels.push({ latlng, el: textEl });
}
function drawDistanceLabelSVG(latlng, text) {
  const svg = map.getRenderer(map)._container;

  const textEl = document.createElementNS('http://www.w3.org/2000/svg', 'text');
  textEl.classList.add('azimuth-distance-svg');

  // ‚¨áÔ∏è –¢–û–ß–ù–û –ö–ê–ö –£ –ê–ó–ò–ú–£–¢–ê
  textEl.setAttribute('text-anchor', 'start');
  textEl.setAttribute('dominant-baseline', 'middle');
  textEl.textContent = text;
  textEl.style.fill = '#2f47ff';
  textEl.style.fontSize = '11px';
  textEl.style.fontFamily = 'Roboto, Arial, sans-serif';
  textEl.style.fontWeight = '400';
  textEl.style.pointerEvents = 'none';

  svg.appendChild(textEl);

  azimuthDistanceLabels.push({
    latlng,
    el: textEl
  });
}



/* =========================
   UI INIT
========================= */

document.addEventListener('DOMContentLoaded', () => {
  const radiusInput = document.getElementById('azimuth-radius');
  const stepInput   = document.getElementById('azimuth-step');
  const radiusText  = document.getElementById('azimuth-radius-text');
  const stepText    = document.getElementById('azimuth-step-text');

  radiusText.textContent = radiusInput.value + ' –∫–º';
  stepText.textContent   = stepInput.value + ' –∫–º';

  radiusInput.addEventListener('input', () => {
    azimuthConfig.radius = Number(radiusInput.value);
    radiusText.textContent = azimuthConfig.radius + ' –∫–º';
  });

  stepInput.addEventListener('input', () => {
    azimuthConfig.step = Number(stepInput.value);
    stepText.textContent = azimuthConfig.step + ' –∫–º';
  });
});

document.addEventListener('click', e => {
  if (!e.target.closest('.azimuth-apply')) return;

  const legendCheckbox = document.getElementById('azimuth-legend');
  azimuthConfig.legend = legendCheckbox ? legendCheckbox.checked : false;

  document.getElementById('azimuthSettingsOverlay').style.display = 'none';
  azimuthPickMode = true;
  map.getContainer().style.cursor = 'crosshair';
});

/* =========================
   MAP EVENTS
========================= */

map.on('click', e => {
  if (!azimuthPickMode) return;

  azimuthPickMode = false;
  map.getContainer().style.cursor = '';

  drawAzimuthGrid(e.latlng, azimuthConfig);
});

map.on('zoom move', () => {
  azimuthSvgLabels.forEach(i =>
    updateAzimuthSvgLabelPosition(i.latlng, i.el)
  );

  azimuthDistanceLabels.forEach(i => {
    const p = map.latLngToLayerPoint(i.latlng);

    const OFFSET_X = 8; // –ª—ë–≥–∫–∏–π —É–≤–æ–¥ –æ—Ç –ª—É—á–∞
    i.el.setAttribute('x', p.x + OFFSET_X);
    i.el.setAttribute('y', p.y);
  });
});



/* =========================
   DRAW GRID
========================= */
function drawAzimuthGrid(latlng, config) {
  const center = L.latLng(latlng.lat, latlng.lng);

  // –æ—á–∏—Å—Ç–∫–∞
  azimuthSvgLabels.forEach(i => i.el.remove());
  azimuthSvgLabels.length = 0;

  azimuthDistanceLabels.forEach(i => i.el.remove());
  azimuthDistanceLabels.length = 0;

  if (azimuthLayer) map.removeLayer(azimuthLayer);
  azimuthLayer = L.layerGroup().addTo(map);

  const { radius, step, legend } = config;

  /* ===== –û–ö–†–£–ñ–ù–û–°–¢–ò ===== */
  for (let r = step; r <= radius; r += step) {
    const pts = [];
    for (let a = 0; a <= 360; a += 2) {
      pts.push(destinationPoint(center, a, r));
    }
const isOuter = r + step > radius;

    L.polyline(pts, {
      color: '#2f47ff',
       weight: isOuter ? 2.5 : 1
    }).addTo(azimuthLayer);
  }

  /* ===== –ü–û–î–ü–ò–°–ò –†–ê–°–°–¢–û–Ø–ù–ò–ô ===== */
  for (let r = step; r <= radius; r += step) {
const labelR = r + step / 2;

if (labelR <= 0) continue;

const labelPoint = destinationPoint(center, 0, labelR);


    if (r === radius) {
      // –≤–Ω–µ—à–Ω—è—è ‚Äî –≤—Å–µ–≥–¥–∞
      drawDistanceLabelSVG(labelPoint, r.toString(), true);
    } else {
      // –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ ‚Äî —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ –∑—É–º—É
      drawDistanceLabelSVG(labelPoint, r.toString(), false);
    }
  }

  /* ===== –õ–£–ß–ò –ò –£–ì–õ–´ ===== */
  for (let angle = 0; angle < 360; angle += 30) {
    const end = destinationPoint(center, angle, radius * (legend ? 1.05 : 1));
    L.polyline([center, end], {
      color: '#2f47ff',
      weight: 1
    }).addTo(azimuthLayer);

    if (legend) {
      const labelPoint = destinationPoint(center, angle, radius * 1.08);
      drawAzimuthLabelSVG(labelPoint, angle.toString());
    }
  }
}

/* =========================
   GEO MATH
========================= */

function destinationPoint(center, bearingDeg, distanceKm) {
  const R = 6371;
  const brng = bearingDeg * Math.PI / 180;
  const d = distanceKm / R;

  const lat1 = center.lat * Math.PI / 180;
  const lon1 = center.lng * Math.PI / 180;

  const lat2 = Math.asin(
    Math.sin(lat1) * Math.cos(d) +
    Math.cos(lat1) * Math.sin(d) * Math.cos(brng)
  );

  const lon2 = lon1 + Math.atan2(
    Math.sin(brng) * Math.sin(d) * Math.cos(lat1),
    Math.cos(d) - Math.sin(lat1) * Math.sin(lat2)
  );

  return L.latLng(lat2 * 180 / Math.PI, lon2 * 180 / Math.PI);
}


</script>

</body>
</html>